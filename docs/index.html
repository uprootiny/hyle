<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hyle - Rust-native code assistant</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>></text></svg>">
  <style>
    :root {
      --bg: #0d1117;
      --fg: #c9d1d9;
      --dim: #6e7681;
      --accent: #7aa2f7;
      --green: #9ece6a;
      --yellow: #e0af68;
      --red: #f7768e;
      --surface: #161b22;
      --border: #30363d;
      --bevel-hi: #2d333b;
      --bevel-lo: #0a0d12;
      --mono: 'Berkeley Mono', 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      min-height: 100vh;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 2rem; }

    header { padding: 4rem 0 2rem; text-align: center; }
    h1 { font-size: 3rem; font-weight: 400; letter-spacing: -0.02em; }
    h1 span { color: var(--accent); }
    .tagline { color: var(--dim); margin-top: 0.5rem; font-size: 1.1rem; }
    .tagline-detail {
      color: var(--dim);
      font-size: 0.9rem;
      max-width: 600px;
      margin: 1.5rem auto 0;
      line-height: 1.7;
    }

    .terminal {
      background: linear-gradient(180deg, #1a2028 0%, #131922 100%);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin: 2rem 0;
      overflow: hidden;
      box-shadow:
        inset 1px 1px 0 var(--bevel-hi),
        inset -1px -1px 0 var(--bevel-lo),
        0 16px 30px rgba(0, 0, 0, 0.28);
      position: relative;
    }
    .terminal::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0) 22%);
    }
    .terminal-header {
      background: #21262d;
      padding: 0.5rem 1rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .terminal-dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot-red { background: #ff5f56; }
    .dot-yellow { background: #ffbd2e; }
    .dot-green { background: #27c93f; }
    .terminal-title { margin-left: auto; color: var(--dim); font-size: 0.75rem; }
    .terminal-body {
      padding: 1rem;
      font-size: 0.85rem;
      min-height: 280px;
      max-height: 350px;
      overflow-y: auto;
    }
    .terminal-line {
      margin: 0.2rem 0;
      opacity: 0;
      transform: translateY(5px);
      animation: lineIn 0.2s ease forwards;
    }
    .terminal-line .prompt { color: var(--green); }
    .terminal-line .cmd { color: var(--fg); }
    .terminal-line .output { color: var(--dim); }
    .terminal-line .success { color: var(--green); }
    .terminal-line .info { color: var(--accent); }
    .terminal-line .warn { color: var(--yellow); }
    .terminal-line .file { color: var(--yellow); text-decoration: underline; cursor: pointer; }
    .terminal-line .file:hover { color: var(--accent); }
    @keyframes lineIn { to { opacity: 1; transform: translateY(0); } }

    .terminal-controls {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: #21262d;
      border-top: 1px solid var(--border);
      align-items: center;
    }
    .terminal-btn {
      padding: 0.3rem 0.75rem;
      background: var(--border);
      border: 1px solid #484f58;
      border-radius: 4px;
      color: var(--dim);
      font-family: var(--mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .terminal-btn:hover { background: #484f58; color: var(--fg); }
    .terminal-btn.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }
    .demo-selector { margin-left: auto; display: flex; gap: 0.25rem; }
    .demo-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--border); cursor: pointer; transition: all 0.2s;
    }
    .demo-dot:hover { background: var(--dim); }
    .demo-dot.active { background: var(--accent); }
    .demo-label { font-size: 0.7rem; color: var(--dim); margin-left: 0.5rem; }

    .section-header {
      margin: 4rem 0 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    .section-header h2 { font-size: 1.1rem; font-weight: 500; color: var(--fg); }
    .section-header p { font-size: 0.85rem; color: var(--dim); margin-top: 0.25rem; }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }
    .feature {
      padding: 1.25rem;
      background: var(--surface);
      border-radius: 8px;
      border: 1px solid var(--border);
      transition: border-color 0.2s, transform 0.2s;
      cursor: pointer;
    }
    .feature:hover { border-color: var(--accent); transform: translateY(-2px); }
    .feature h3 {
      color: var(--accent);
      margin-bottom: 0.5rem;
      font-weight: 500;
      font-size: 0.95rem;
    }
    .feature p { color: var(--dim); font-size: 0.85rem; line-height: 1.6; }
    .feature-detail {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, margin-top 0.3s ease;
    }
    .feature.expanded .feature-detail { max-height: 250px; margin-top: 0.75rem; }
    .feature-code {
      background: var(--bg);
      padding: 0.75rem;
      border-radius: 4px;
      font-size: 0.8rem;
      overflow-x: auto;
      white-space: pre;
    }

    /* ── Affordance Cascade ────────────────────────── */
    .cascade { margin: 2rem 0; }
    .cascade-level {
      position: relative;
      border-left: 2px solid var(--border);
      margin-left: 1.2rem;
      padding: 0 0 0.5rem 1.5rem;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .cascade-level.visible { opacity: 1; transform: translateY(0); }
    .cascade-level:last-child { border-left-color: transparent; }
    .cascade-level::before {
      content: attr(data-level);
      position: absolute;
      left: -1.1rem;
      top: 0;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      background: var(--surface);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: var(--dim);
      font-weight: 600;
      z-index: 1;
      transition: all 0.3s;
    }
    .cascade-level.active::before {
      border-color: var(--accent);
      color: var(--accent);
      background: #161b22;
      box-shadow: 0 0 12px rgba(122, 162, 247, 0.3);
    }
    .cascade-level.active { border-left-color: var(--accent); }
    .cascade-head {
      cursor: pointer;
      padding: 0.6rem 0.9rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .cascade-head:hover { border-color: var(--dim); background: #1c2128; }
    .cascade-level.active .cascade-head { border-color: var(--accent); }
    .cascade-icon { font-size: 1.1rem; flex-shrink: 0; }
    .cascade-info { flex: 1; min-width: 0; }
    .cascade-title {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--fg);
      margin-bottom: 0.15rem;
    }
    .cascade-sub { font-size: 0.78rem; color: var(--dim); }
    .cascade-tag {
      font-size: 0.65rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--dim);
      flex-shrink: 0;
    }
    .cascade-tag.ready { color: var(--green); border-color: rgba(158, 206, 106, 0.3); }
    .cascade-tag.wip { color: var(--yellow); border-color: rgba(224, 175, 104, 0.3); }
    .cascade-tag.new { color: var(--accent); border-color: rgba(122, 162, 247, 0.3); }
    .cascade-chevron {
      color: var(--dim);
      font-size: 0.75rem;
      transition: transform 0.3s;
      flex-shrink: 0;
    }
    .cascade-level.active .cascade-chevron { transform: rotate(90deg); }
    .cascade-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, margin-top 0.3s ease;
    }
    .cascade-level.active .cascade-body {
      max-height: 400px;
      margin-top: 0.6rem;
    }
    .cascade-content {
      padding: 0.75rem;
      background: linear-gradient(180deg, #121820, #0f141b);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.8rem;
    }
    .cascade-content p { color: var(--dim); line-height: 1.7; margin-bottom: 0.6rem; }
    .cascade-content pre {
      background: var(--bg);
      padding: 0.6rem 0.75rem;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre;
      font-size: 0.78rem;
      line-height: 1.5;
    }
    .cascade-flow {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }
    .cascade-flow-step {
      font-size: 0.7rem;
      padding: 0.2rem 0.55rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--dim);
    }
    .cascade-flow-arrow { color: var(--accent); font-size: 0.7rem; align-self: center; }

    .examples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
    }
    .example-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .example-card:hover { border-color: var(--dim); }
    .example-card.expanded { grid-column: 1 / -1; border-color: var(--accent); }
    .example-header {
      padding: 1rem 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: background 0.15s;
    }
    .example-header:hover { background: #1c2128; }
    .example-icon { font-size: 1.25rem; }
    .example-info { flex: 1; }
    .example-title { font-weight: 500; font-size: 0.9rem; margin-bottom: 0.15rem; }
    .example-subtitle { font-size: 0.8rem; color: var(--dim); }
    .example-tag {
      padding: 0.2rem 0.6rem;
      background: var(--bg);
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 500;
    }
    .example-tag.easy { color: var(--green); }
    .example-tag.creative { color: var(--yellow); }
    .example-tag.wow { color: var(--red); }
    .example-expand { color: var(--dim); transition: transform 0.3s; }
    .example-card.expanded .example-expand { transform: rotate(180deg); }
    .example-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
    .example-card.expanded .example-body { max-height: 600px; }
    .example-content { padding: 0 1.25rem 1.25rem; }
    .example-prose { font-size: 0.85rem; color: var(--dim); line-height: 1.7; margin-bottom: 1rem; }
    .example-terminal { background: var(--bg); border-radius: 6px; overflow: hidden; }
    .example-terminal-header {
      padding: 0.5rem 0.75rem;
      background: #1c2128;
      font-size: 0.7rem;
      color: var(--dim);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .example-terminal-body { padding: 0.75rem; font-size: 0.8rem; max-height: 250px; overflow-y: auto; }
    .copy-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--dim);
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      cursor: pointer;
      font-family: var(--mono);
    }
    .copy-btn:hover { color: var(--fg); border-color: var(--dim); }
    .copy-btn.copied { color: var(--green); border-color: var(--green); }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .cta { text-align: center; margin: 4rem 0 2rem; }
    .cta-button {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: var(--accent);
      color: var(--bg);
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.95rem;
      transition: all 0.2s;
    }
    .cta-button:hover { opacity: 0.9; text-decoration: none; transform: translateY(-2px); }
    .cta-secondary { display: block; margin-top: 1rem; font-size: 0.85rem; color: var(--dim); }

    footer {
      padding: 2rem;
      text-align: center;
      color: var(--dim);
      font-size: 0.8rem;
      border-top: 1px solid var(--border);
      margin-top: 2rem;
    }
    footer a { color: var(--dim); }
    footer a:hover { color: var(--accent); }

    .variant-switcher { position: fixed; bottom: 1rem; right: 1rem; z-index: 1000; }
    .switcher-toggle {
      width: 32px; height: 32px; border-radius: 50%;
      background: #21262d; border: 1px solid var(--border);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--dim); font-size: 14px; transition: all 0.2s;
    }
    .switcher-toggle:hover { background: var(--border); color: var(--fg); }
    .switcher-panel {
      position: absolute; bottom: 40px; right: 0;
      background: var(--surface); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.5rem; display: none; min-width: 180px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    .switcher-panel.open { display: block; }
    .switcher-item {
      display: block; padding: 0.5rem 0.75rem; color: var(--dim);
      font-size: 0.75rem; border-radius: 4px; cursor: pointer; transition: all 0.15s;
    }
    .switcher-item:hover { background: #21262d; color: var(--fg); text-decoration: none; }
    .switcher-item.active { color: var(--accent); background: #21262d; }

  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><span>></span> hyle</h1>
      <p class="tagline">Code assistant in a single Rust binary</p>
      <p class="tagline-detail">
        <code>cargo install</code>, set an OpenRouter key, start working. 7 tools the LLM calls directly (read, write, edit, grep, glob, bash, patch). 30+ slash commands that run locally with zero latency. Multi-model. Session persistence. Event-sourced everything.
      </p>
    </header>

    <div class="terminal" id="mainTerminal">
      <div class="terminal-header">
        <span class="terminal-dot dot-red"></span>
        <span class="terminal-dot dot-yellow"></span>
        <span class="terminal-dot dot-green"></span>
        <span class="terminal-title" id="terminalTitle">~/project</span>
      </div>
      <div class="terminal-body" id="terminalBody"></div>
      <div class="terminal-controls">
        <div class="demo-selector">
          <div class="demo-dot active" onclick="switchDemo(0)" title="Tool use loop"></div>
          <div class="demo-dot" onclick="switchDemo(1)" title="Slash commands"></div>
          <div class="demo-dot" onclick="switchDemo(2)" title="Agentic task"></div>
          <div class="demo-dot" onclick="switchDemo(3)" title="Self-correction"></div>
        </div>
        <span class="demo-label" id="demoLabel">Tool use loop</span>
        <button class="terminal-btn" onclick="switchDemo(currentDemo)" style="margin-left:auto">Replay</button>
      </div>
    </div>

    <div class="section-header">
      <h2>Affordance cascade</h2>
      <p>Each layer builds on the previous. Click to expand.</p>
    </div>

    <div class="cascade" id="affordanceCascade">
      <div class="cascade-level" data-level="0">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">$</span>
          <div class="cascade-info">
            <div class="cascade-title">Install</div>
            <div class="cascade-sub">Single binary, no runtime dependencies</div>
          </div>
          <span class="cascade-tag ready">ready</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <pre><span style="color:var(--green)">$</span> cargo install --git https://github.com/uprootiny/hyle
<span style="color:var(--green)">$</span> hyle doctor
<span style="color:var(--green)">&#x2713;</span> API key configured
<span style="color:var(--green)">&#x2713;</span> OpenRouter reachable
<span style="color:var(--green)">&#x2713;</span> State directory ready</pre>
            <div class="cascade-flow">
              <span class="cascade-flow-step">cargo install</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">hyle doctor</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">ready</span>
            </div>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="1">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">></span>
          <div class="cascade-info">
            <div class="cascade-title">Chat</div>
            <div class="cascade-sub">Streaming responses, multi-model, session persistence</div>
          </div>
          <span class="cascade-tag ready">ready</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>Type a prompt, get a streaming response. Switch models with <code>/model</code>. Resume sessions across restarts. 35+ free models via OpenRouter.</p>
            <pre><span style="color:var(--green)">></span> explain the borrow checker error on line 47
<span style="color:var(--dim)">The value `connection` is moved into the async block...</span>

<span style="color:var(--green)">></span> /model deepseek/deepseek-chat-v3-0324:free
<span style="color:var(--yellow)">Switched to deepseek-chat-v3 (free)</span></pre>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="2">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">&#x2692;</span>
          <div class="cascade-info">
            <div class="cascade-title">Tool use</div>
            <div class="cascade-sub">read, write, edit, bash, grep &mdash; executed directly</div>
          </div>
          <span class="cascade-tag ready">ready</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>The LLM emits tool calls, hyle executes them. Atomic writes with backup rotation. Recursive grep. Search-and-replace edits. Compilation verification before commit.</p>
            <pre><span style="color:var(--accent)">[read]</span>  src/routes/upload.rs (247 lines)
<span style="color:var(--accent)">[grep]</span>  "rate_limit" in src/ (3 matches)
<span style="color:var(--accent)">[edit]</span>  src/routes/upload.rs: +4 -1 lines
<span style="color:var(--accent)">[bash]</span>  cargo check
<span style="color:var(--green)">&#x2713;</span> compiles</pre>
            <div class="cascade-flow">
              <span class="cascade-flow-step">read</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">grep</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">edit</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">bash</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">verify</span>
            </div>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="3">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">&#x21BB;</span>
          <div class="cascade-info">
            <div class="cascade-title">Agentic loop</div>
            <div class="cascade-sub">Plan, execute, verify, iterate until done</div>
          </div>
          <span class="cascade-tag wip">experimental</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>Multi-step autonomous execution with bounded context window (16-message cap with summarization). Intent detection prevents narration without action. Permission system gates destructive operations.</p>
            <pre><span style="color:var(--green)">$</span> hyle --task "add JWT auth to all routes"
<span style="color:var(--dim)">iteration 1:</span> <span style="color:var(--accent)">[read]</span> src/routes/*.rs
<span style="color:var(--dim)">iteration 2:</span> <span style="color:var(--accent)">[write]</span> src/middleware/auth.rs
<span style="color:var(--dim)">iteration 3:</span> <span style="color:var(--accent)">[edit]</span> src/routes/mod.rs
<span style="color:var(--dim)">iteration 4:</span> <span style="color:var(--accent)">[bash]</span> cargo test
<span style="color:var(--green)">&#x2713;</span> 47 tests passed (4 iterations, 12.3s)</pre>
            <div class="cascade-flow">
              <span class="cascade-flow-step">plan</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">execute</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">verify</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">iterate</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">done</span>
            </div>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="4">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">&#x25C9;</span>
          <div class="cascade-info">
            <div class="cascade-title">Observability</div>
            <div class="cascade-sub">JSONL event logs, UX metrics, token tracking, cost telemetry</div>
          </div>
          <span class="cascade-tag new">new</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>Every agent run emits structured events to JSONL. UX metrics track responsiveness (time-to-first-token), smoothness (token rate variance), and autonomy (tasks completed vs stuck). Token usage and cost tracked per session.</p>
            <pre><span style="color:var(--green)">></span> /cost
<span style="color:var(--yellow)">Session:</span> a3f7c2d
  Tokens in:  47,832  ($0.024)
  Tokens out: 12,441  ($0.037)
  UX score:   78/100

<span style="color:var(--green)">$</span> cat ~/.local/share/hyle/run_a3f7c2d.jsonl
<span style="color:var(--dim)">{"event":"tool_call","tool":"read","args":{"path":"src/lib.rs"}...}</span></pre>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="5">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">&#x2638;</span>
          <div class="cascade-info">
            <div class="cascade-title">Self-correction</div>
            <div class="cascade-sub">Smoke tests, recentering prompts, homeostasis interrupts</div>
          </div>
          <span class="cascade-tag new">new</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>13-tier recentering prompt system detects when the agent drifts (over-architecting, hallucinating APIs, ignoring tests) and injects corrective nudges. From gentle taps to hard resets. Automatic symptom-to-prompt classifier.</p>
            <pre><span style="color:var(--green)">$</span> hyle smoke
<span style="color:var(--green)">&#x2713;</span> recenter-list   4 prompts loaded
<span style="color:var(--green)">&#x2713;</span> recenter-all    all prompts parseable
<span style="color:var(--green)">&#x2713;</span> recenter-auto   classifier selects tier 3

<span style="color:var(--green)">></span> /recenter auto
<span style="color:var(--yellow)">[tier 3: Test-First Nudge]</span>
<span style="color:var(--dim)">Before changing more code, run the existing tests...</span></pre>
          </div>
        </div>
      </div>

      <div class="cascade-level" data-level="6">
        <div class="cascade-head" onclick="toggleCascade(this.parentElement)">
          <span class="cascade-icon">&#x2637;</span>
          <div class="cascade-info">
            <div class="cascade-title">Orchestration</div>
            <div class="cascade-sub">Scenarios, timed prompt injection, multi-phase workflows</div>
          </div>
          <span class="cascade-tag wip">experimental</span>
          <span class="cascade-chevron">&#x25B6;</span>
        </div>
        <div class="cascade-body">
          <div class="cascade-content">
            <p>Define scenario files with phased prompt injection. Triggers fire on iteration count, elapsed time, output patterns, or task completion. The scenario runner nudges the agent through multi-phase workflows without manual intervention.</p>
            <pre><span style="color:var(--dim)">// scenario.json</span>
{ "phases": [
  { "trigger": "Immediate",
    "prompt": "Read the codebase structure first" },
  { "trigger": { "AfterIterations": 3 },
    "prompt": "Now run the test suite" },
  { "trigger": { "OnPattern": "test.*fail" },
    "prompt": "Fix failing tests before proceeding" }
]}</pre>
            <div class="cascade-flow">
              <span class="cascade-flow-step">scenario.json</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">phase triggers</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">prompt injection</span>
              <span class="cascade-flow-arrow">&#x2192;</span>
              <span class="cascade-flow-step">agent adapts</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-header">
      <h2>What actually works</h2>
      <p>Honest inventory. Green = solid. Yellow = works but has rough edges.</p>
    </div>

    <div class="features">
      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--green)">&#x25CF;</span> 7 tools, executed directly</h3>
        <p>read, write, edit, grep, glob, bash, patch. The LLM emits tool calls, hyle runs them. Atomic writes with backup rotation. Recursive grep. Compilation verification.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--accent)">[read]</span>  src/lib.rs (312 lines)
<span style="color:var(--accent)">[grep]</span>  "parse_token" in src/ (7 matches)
<span style="color:var(--accent)">[edit]</span>  src/lib.rs: replace line 47
<span style="color:var(--accent)">[bash]</span>  cargo check
<span style="color:var(--green)">&#x2713;</span> compiles, backup at .bak.1</div>
        </div>
      </div>

      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--green)">&#x25CF;</span> 30+ slash commands</h3>
        <p>Run locally, zero latency, no API call. <code>/build</code> <code>/test</code> <code>/diff</code> <code>/commit</code> <code>/status</code> <code>/cost</code> <code>/grep</code> <code>/doctor</code> <code>/recenter</code> and more.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--green)">></span> /status
<span style="color:var(--yellow)">Modified:</span> src/lib.rs, src/parser.rs
<span style="color:var(--green)">></span> /diff src/lib.rs
<span style="color:var(--red)">-    let result = parse(input)?;</span>
<span style="color:var(--green)">+    let result = parse(input)
+        .map_err(|e| anyhow!("Parse: {}", e))?;</span>
<span style="color:var(--green)">></span> /commit "fix parse error handling"
<span style="color:var(--green)">&#x2713;</span> [a3f7c2d] fix parse error handling</div>
        </div>
      </div>

      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--green)">&#x25CF;</span> Multi-model via OpenRouter</h3>
        <p>35+ free models. Switch mid-session with <code>/model</code>. DeepSeek, Qwen, Llama, Claude, GPT-4. Fuzzy search picker.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--green)">$</span> hyle --free
<span style="color:var(--dim)">[Using deepseek/deepseek-chat-v3-0324:free]</span>
<span style="color:var(--green)">></span> /model qwen
<span style="color:var(--yellow)">Switched:</span> qwen/qwen-2.5-coder-32b-instruct:free</div>
        </div>
      </div>

      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--green)">&#x25CF;</span> Safety guardrails</h3>
        <p>Destructive command blocking. Permission system (deny/ask/auto per tool category). Atomic writes never corrupt files.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--red)">[BLOCKED]</span> rm -rf / matches dangerous pattern
<span style="color:var(--yellow)">[ASK]</span> bash: cargo clean (destructive, confirm?)
<span style="color:var(--green)">[AUTO]</span> read: src/lib.rs (safe, proceed)</div>
        </div>
      </div>

      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--yellow)">&#x25CF;</span> Agentic loop (experimental)</h3>
        <p>Multi-step autonomous execution. Context window capped at 16 messages with summarization. Intent detection prevents idle narration. Best on bounded tasks.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--green)">$</span> hyle --task "add error handling to parse()"
<span style="color:var(--dim)">iter 1:</span> [read] src/lib.rs
<span style="color:var(--dim)">iter 2:</span> [edit] src/lib.rs (+12 -3)
<span style="color:var(--dim)">iter 3:</span> [bash] cargo test
<span style="color:var(--green)">&#x2713;</span> 3 iterations, all tests pass</div>
        </div>
      </div>

      <div class="feature" onclick="toggleFeature(this)">
        <h3><span style="color:var(--yellow)">&#x25CF;</span> Self-correction</h3>
        <p>13-tier recentering prompt system. Detects when the agent drifts and injects corrective nudges. From gentle taps to hard resets. <code>/recenter auto</code>.</p>
        <div class="feature-detail">
          <div class="feature-code"><span style="color:var(--green)">$</span> hyle smoke
<span style="color:var(--green)">&#x2713;</span> recenter-list  4 prompts loaded
<span style="color:var(--green)">&#x2713;</span> recenter-auto  classifier: tier 3
<span style="color:var(--green)">></span> /recenter auto
<span style="color:var(--yellow)">[tier 3: Test-First Nudge]</span></div>
        </div>
      </div>
    </div>

    <div class="section-header">
      <h2>Real-world examples</h2>
      <p>Click to expand and see the actual prompts</p>
    </div>

    <div class="examples-grid">
      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F4DD;</span>
          <div class="example-info">
            <div class="example-title">Stripe webhook types from JSON</div>
            <div class="example-subtitle">Paste API response, get serde structs</div>
          </div>
          <span class="example-tag easy">painless</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              You're integrating with Stripe's API and need to deserialize webhook payloads. Instead of manually transcribing JSON into Rust structs, paste a sample response and get types with proper serde attributes, Option&lt;T&gt; for nullable fields, and chrono DateTime handling.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/payment-service</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'stripe')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> generate rust types from this stripe webhook:
{"id":"evt_1abc","type":"payment_intent.succeeded",
 "data":{"object":{"id":"pi_xyz","amount":2000,
 "currency":"usd","customer":"cus_123"}}}

<span style="color:var(--accent)">[write]</span> src/stripe/types.rs (89 lines)
<span style="color:var(--accent)">[bash]</span> cargo check
<span style="color:var(--green)">Compiles successfully</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F527;</span>
          <div class="example-info">
            <div class="example-title">Fix async lifetime errors</div>
            <div class="example-subtitle">Compiler error in, working code out</div>
          </div>
          <span class="example-tag easy">painless</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              Rust's async lifetime errors are cryptic. "Lifetime may not live long enough" pointing at trait bounds you didn't write. Paste the error, hyle reads the file, understands ownership flow, and applies the fix.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/realtime-sync</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'lifetime')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> fix this:
error[E0597]: `connection` does not live long enough
  --> src/ws/handler.rs:47:23

<span style="color:var(--accent)">[read]</span> src/ws/handler.rs
<span style="color:var(--dim)">The spawn requires 'static. Clone the Arc.</span>

<span style="color:var(--accent)">[patch]</span> src/ws/handler.rs
<span style="color:var(--green)">cargo check: ok</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F9EA;</span>
          <div class="example-info">
            <div class="example-title">Generate tests from implementation</div>
            <div class="example-subtitle">Comprehensive coverage, edge cases included</div>
          </div>
          <span class="example-tag easy">painless</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              You've written the parser, now you need tests. Point hyle at the module and it analyzes the public API, identifies edge cases, and generates a test file that exercises the paths that matter.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/markdown-compiler</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'tests')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> write tests for src/parser/inline.rs

<span style="color:var(--accent)">[read]</span> src/parser/inline.rs (312 lines)
<span style="color:var(--accent)">[write]</span> tests/parser_inline_tests.rs (247 lines)

<span style="color:var(--dim)">Generated for:</span>
  parse_emphasis - 6 tests (nested, unmatched)
  parse_link - 8 tests (inline, reference)
  parse_code_span - 4 tests

<span style="color:var(--accent)">[bash]</span> cargo test parser_inline
<span style="color:var(--green)">23 tests passed</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F512;</span>
          <div class="example-info">
            <div class="example-title">Add JWT auth to all routes</div>
            <div class="example-subtitle">Middleware, extractors, error handling</div>
          </div>
          <span class="example-tag easy">painless</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              Security boilerplate is tedious. hyle reads your route handlers, creates JWT validation middleware with proper error responses, adds extractor types, and wires everything together.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/inventory-api</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'jwt')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> add JWT auth to src/routes/*, return 401 for invalid

<span style="color:var(--accent)">[read]</span> src/routes/*.rs (4 files)
<span style="color:var(--accent)">[write]</span> src/middleware/auth.rs (78 lines)
<span style="color:var(--accent)">[write]</span> src/auth/claims.rs (34 lines)
<span style="color:var(--accent)">[patch]</span> src/routes/mod.rs (+12 lines)
<span style="color:var(--accent)">[patch]</span> Cargo.toml (jsonwebtoken = "9")

<span style="color:var(--accent)">[bash]</span> cargo test
<span style="color:var(--green)">47 tests passed</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F3A8;</span>
          <div class="example-info">
            <div class="example-title">Description to Leptos component</div>
            <div class="example-subtitle">Reactive state, event handlers, CSS</div>
          </div>
          <span class="example-tag creative">creative</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              You know what you want the UI to look like. Describe it in words and hyle generates a complete Leptos component with signals, derived state, event handlers, and CSS.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/file-manager</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'leptos')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> create file browser component:
- tree view left (collapsible folders)
- file preview right
- breadcrumb nav top
- keyboard nav (j/k, enter to open)

<span style="color:var(--accent)">[write]</span> src/components/file_browser.rs
<span style="color:var(--accent)">[write]</span> src/components/file_browser.css

<span style="color:var(--dim)">Created with:</span>
  - RwSignal&lt;Vec&lt;TreeNode&gt;&gt; for tree
  - create_effect for keyboard
  - Accessible ARIA attributes

<span style="color:var(--accent)">[bash]</span> trunk serve
<span style="color:var(--green)">http://localhost:8080</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F504;</span>
          <div class="example-info">
            <div class="example-title">Port Python to Rust</div>
            <div class="example-subtitle">Idiomatic translation, not transliteration</div>
          </div>
          <span class="example-tag creative">creative</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              That Python prototype is now a bottleneck. hyle understands Python idioms and maps them to Rust: dict comprehensions become iterators, context managers become RAII, exceptions become Result.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/image-processor</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'pyrust')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> port to rust with tokio:

async def process_batch(paths):
    async with aiofiles.open("log.txt", "a") as log:
        for path in paths:
            try:
                img = Image.open(path)
                results[path.stem] = analyze(img)
            except Exception as e:
                await log.write(f"Failed: {e}\n")

<span style="color:var(--accent)">[write]</span> src/processor.rs (67 lines)
<span style="color:var(--accent)">[bash]</span> cargo clippy
<span style="color:var(--green)">No warnings</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F680;</span>
          <div class="example-info">
            <div class="example-title">Entity to full CRUD stack</div>
            <div class="example-subtitle">Migrations, handlers, tests, OpenAPI</div>
          </div>
          <span class="example-tag wow">impressive</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              Describe an entity's fields and hyle generates the complete vertical slice: SQLx migrations, model structs with validation, CRUD handlers, integration tests, and OpenAPI documentation. All following your existing patterns.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/saas-platform</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'crud')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> create entity: Subscription
- id: UUID
- user_id: UUID (foreign key)
- plan: enum (free, pro, enterprise)
- status: enum (active, cancelled, past_due)
- current_period_end: DateTime
- stripe_subscription_id: Option&lt;String&gt;

<span style="color:var(--accent)">[write]</span> migrations/20260110_subscriptions.sql
<span style="color:var(--accent)">[write]</span> src/models/subscription.rs
<span style="color:var(--accent)">[write]</span> src/handlers/subscriptions.rs
<span style="color:var(--accent)">[write]</span> tests/subscriptions_test.rs

<span style="color:var(--accent)">[bash]</span> sqlx migrate run && cargo test
<span style="color:var(--green)">12 tests passed. 5 files, 847 lines.</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F504;</span>
          <div class="example-info">
            <div class="example-title">Split 2000-line monolith</div>
            <div class="example-subtitle">Modules, imports, Cargo.toml updates</div>
          </div>
          <span class="example-tag wow">impressive</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              The file that started as "temporary" is now 2000 lines. hyle analyzes the dependency graph, identifies natural module boundaries, extracts code into proper structure, fixes imports, and verifies compilation.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/event-sourcing</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'split')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> src/event_store.rs is 2000 lines, split into modules

<span style="color:var(--accent)">[read]</span> src/event_store.rs (2,147 lines)
<span style="color:var(--dim)">Found 6 clusters:</span>
  Storage (412) - Projection (387) - Snapshot (234)
  Subscription (298) - Aggregate (456) - Types (360)

<span style="color:var(--accent)">[mkdir]</span> src/event_store/
<span style="color:var(--accent)">[write]</span> src/event_store/mod.rs
<span style="color:var(--accent)">[write]</span> src/event_store/{storage,projection,...}.rs
<span style="color:var(--accent)">[delete]</span> src/event_store.rs

<span style="color:var(--accent)">[bash]</span> cargo test
<span style="color:var(--green)">All 89 tests pass</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F41B;</span>
          <div class="example-info">
            <div class="example-title">Debug production panic</div>
            <div class="example-subtitle">Stack trace to root cause to fix</div>
          </div>
          <span class="example-tag wow">impressive</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              Your monitoring alerts on a panic. Paste the stack trace, hyle correlates with source, identifies the failing unwrap, explains why, fixes error handling, and adds a regression test.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/trading-engine</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'panic')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> sentry shows this, fix it:
panicked at 'called `Option::unwrap()` on `None`',
src/orderbook/matching.rs:142:35

<span style="color:var(--accent)">[read]</span> src/orderbook/matching.rs

<span style="color:var(--dim)">Line 142: let price = self.best_bid.unwrap();</span>
<span style="color:var(--dim)">Panics when orderbook empty (no bids).</span>

<span style="color:var(--accent)">[patch]</span> src/orderbook/matching.rs
<span style="color:var(--red)">-    let price = self.best_bid.unwrap();</span>
<span style="color:var(--green)">+    let Some(price) = self.best_bid else {</span>
<span style="color:var(--green)">+        return Err(MatchError::NoLiquidity);</span>
<span style="color:var(--green)">+    };</span>

<span style="color:var(--accent)">[write]</span> tests/orderbook_edge_cases.rs (+1 test)
<span style="color:var(--green)">34 tests passed</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="example-card" onclick="toggleExample(this)">
        <div class="example-header">
          <span class="example-icon">&#x1F4D1;</span>
          <div class="example-info">
            <div class="example-title">Spec to implementation</div>
            <div class="example-subtitle">Step-by-step with tests after each</div>
          </div>
          <span class="example-tag wow">impressive</span>
          <span class="example-expand">&#x25BC;</span>
        </div>
        <div class="example-body">
          <div class="example-content">
            <p class="example-prose">
              Paste a design doc and hyle implements incrementally - writing code, running tests after each step, proceeding only when they pass. Great for well-specified features.
            </p>
            <div class="example-terminal">
              <div class="example-terminal-header">
                <span>~/code/rate-limiter</span>
                <button class="copy-btn" onclick="copyPrompt(event, 'spec')">copy prompt</button>
              </div>
              <div class="example-terminal-body">
<span style="color:var(--green)">></span> implement, test after each step:
## Token Bucket Rate Limiter
- Configurable capacity and refill rate
- Thread-safe (Arc&lt;RateLimiter&gt;)
- Returns remaining tokens on check
- Multiple named buckets
- Async-compatible

<span style="color:var(--dim)">Step 1/5: Core TokenBucket</span>
<span style="color:var(--accent)">[write]</span> src/bucket.rs
<span style="color:var(--green)">4 tests passed</span>

<span style="color:var(--dim)">Step 2/5: Atomic refill</span>
<span style="color:var(--accent)">[patch]</span> src/bucket.rs
<span style="color:var(--green)">6 tests passed</span>

<span style="color:var(--dim)">...steps 3-5...</span>
<span style="color:var(--green)">All 34 tests pass. Docs generated.</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="cta">
      <a href="https://github.com/uprootiny/hyle" class="cta-button">View on GitHub</a>
      <span class="cta-secondary"><code>cargo install --git https://github.com/uprootiny/hyle</code></span>
    </div>
  </div>

  <footer>
    <p>MIT License &middot; <a href="https://github.com/uprootiny/hyle">Source</a> &middot; <a href="https://openrouter.ai/keys">Get Free API Key</a></p>
  </footer>

  <div class="variant-switcher">
    <div class="switcher-toggle" onclick="toggleSwitcher()" title="Page variants">~</div>
    <div class="switcher-panel" id="switcherPanel">
      <a class="switcher-item active" href="index.html">Default</a>
      <a class="switcher-item" href="unix.html">Composable</a>
      <a class="switcher-item" href="velocity.html">Velocity</a>
      <a class="switcher-item" href="reliable.html">Reliable</a>
      <a class="switcher-item" href="depth.html">Depth</a>
      <a class="switcher-item" href="playful.html">Playful</a>
      <a class="switcher-item" href="observable.html">Observable</a>
      <a class="switcher-item" href="community.html">Community</a>
      <a class="switcher-item" href="indie.html">Independent</a>
      <a class="switcher-item" href="learn.html">Learning</a>
      <a class="switcher-item" href="control.html">Control</a>
      <a class="switcher-item" href="secure.html">Secure</a>
      <a class="switcher-item" href="flow.html">Flow</a>
    </div>
  </div>

  <script>
    /* ── Terminal demos: static lines, no API calls ── */
    const demos = [
      { title: '~/project', label: 'Tool use loop', lines: [
        { type: 'cmd', prompt: '>', text: 'fix the unwrap on line 47 of src/lib.rs' },
        { type: 'info', text: '[read] src/lib.rs (312 lines)' },
        { type: 'output', text: 'Line 47: let val = map.get(&key).unwrap();' },
        { type: 'output', text: 'This panics when key is missing. Replacing with match.' },
        { type: 'info', text: '[edit] src/lib.rs: replace line 47' },
        { type: 'output', text: '-    let val = map.get(&key).unwrap();' },
        { type: 'success', text: '+    let Some(val) = map.get(&key) else {' },
        { type: 'success', text: '+        return Err(anyhow!("key not found: {}", key));' },
        { type: 'success', text: '+    };' },
        { type: 'info', text: '[bash] cargo test' },
        { type: 'success', text: '\u2713 23 tests passed. Backup at src/lib.rs.bak.1' },
      ]},
      { title: '~/project', label: 'Slash commands', lines: [
        { type: 'cmd', prompt: '>', text: '/status' },
        { type: 'warn', text: 'Modified: src/lib.rs, src/parser.rs' },
        { type: 'output', text: 'Staged:   tests/integration.rs' },
        { type: 'cmd', prompt: '>', text: '/diff src/lib.rs' },
        { type: 'output', text: '-    let result = parse(input)?;' },
        { type: 'success', text: '+    let result = parse(input)' },
        { type: 'success', text: '+        .map_err(|e| anyhow!("Parse: {}", e))?;' },
        { type: 'cmd', prompt: '>', text: '/cost' },
        { type: 'output', text: 'Tokens in: 12,441  Tokens out: 3,892' },
        { type: 'output', text: 'Total cost: $0.019  Context: 48.8%' },
        { type: 'cmd', prompt: '>', text: '/commit "fix parse error handling"' },
        { type: 'success', text: '\u2713 [a3f7c2d] fix parse error handling' },
      ]},
      { title: '~/project', label: 'Agentic task', lines: [
        { type: 'cmd', prompt: '$', text: 'hyle --task "add rate limiting to /api/upload"' },
        { type: 'output', text: 'iter 1:' },
        { type: 'info', text: '  [read] src/routes/upload.rs (247 lines)' },
        { type: 'info', text: '  [grep] "rate" in src/ (3 matches)' },
        { type: 'output', text: 'iter 2:' },
        { type: 'info', text: '  [write] src/middleware/rate_limit.rs (63 lines)' },
        { type: 'info', text: '  [edit] src/routes/upload.rs (+4 -1)' },
        { type: 'output', text: 'iter 3:' },
        { type: 'info', text: '  [bash] cargo check' },
        { type: 'success', text: '\u2713 Done. 3 iterations, 8.2s, 4,120 tokens' },
      ]},
      { title: '~/project', label: 'Self-correction', lines: [
        { type: 'cmd', prompt: '$', text: 'hyle smoke' },
        { type: 'success', text: '\u2713 recenter-list   4 prompts loaded' },
        { type: 'success', text: '\u2713 recenter-all    all parseable' },
        { type: 'success', text: '\u2713 recenter-auto   classifier selects tier 3' },
        { type: 'cmd', prompt: '>', text: '/recenter auto' },
        { type: 'warn', text: '[tier 3: Test-First Nudge]' },
        { type: 'output', text: 'Before changing more code, run the existing' },
        { type: 'output', text: 'tests. If any fail, fix those first.' },
        { type: 'cmd', prompt: '>', text: '/doctor' },
        { type: 'success', text: '\u2713 API key  \u2713 Connectivity  \u2713 State dir' },
      ]},
    ];

    let currentDemo = 0;
    let demoBusy = false;

    function renderLine(l) {
      const d = document.createElement('div');
      d.className = 'terminal-line';
      const c = l.type === 'cmd' ? `<span class="prompt">${l.prompt}</span> <span class="cmd">${l.text}</span>` :
        l.type === 'info' ? `<span class="info">${l.text}</span>` :
        l.type === 'success' ? `<span class="success">${l.text}</span>` :
        l.type === 'warn' ? `<span class="warn">${l.text}</span>` :
        `<span class="output">${l.text || '&nbsp;'}</span>`;
      d.innerHTML = c;
      return d;
    }

    async function switchDemo(i) {
      if (demoBusy) return;
      demoBusy = true;
      currentDemo = i;
      const demo = demos[i];
      const body = document.getElementById('terminalBody');
      body.innerHTML = '';
      document.getElementById('terminalTitle').textContent = demo.title;
      document.getElementById('demoLabel').textContent = demo.label;
      document.querySelectorAll('.demo-dot').forEach((d, j) => d.classList.toggle('active', i === j));

      for (const line of demo.lines) {
        body.appendChild(renderLine(line));
        body.scrollTop = body.scrollHeight;
        await new Promise(r => setTimeout(r, line.type === 'cmd' ? 120 : 55));
      }
      demoBusy = false;
    }

    function toggleFeature(el) {
      document.querySelectorAll('.feature.expanded').forEach(f => { if (f !== el) f.classList.remove('expanded'); });
      el.classList.toggle('expanded');
    }

    function toggleExample(el) {
      const was = el.classList.contains('expanded');
      document.querySelectorAll('.example-card.expanded').forEach(c => c.classList.remove('expanded'));
      if (!was) el.classList.add('expanded');
    }

    function copyPrompt(e, key) {
      e.stopPropagation();
      const p = document.querySelector(`[data-prompt="${key}"]`);
      if (!p) return;
      navigator.clipboard.writeText(p.textContent).then(() => {
        const btn = e.target;
        btn.textContent = 'copied!';
        btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'copy prompt'; btn.classList.remove('copied'); }, 2000);
      });
    }

    function toggleSwitcher() { document.getElementById('switcherPanel').classList.toggle('open'); }

    document.addEventListener('click', e => {
      if (!e.target.closest('.variant-switcher')) document.getElementById('switcherPanel').classList.remove('open');
    });

    /* ── Affordance Cascade ──────────────────────── */
    function toggleCascade(level) {
      const was = level.classList.contains('active');
      document.querySelectorAll('.cascade-level.active').forEach(l => l.classList.remove('active'));
      if (!was) level.classList.add('active');
    }

    function cascadeReveal() {
      const levels = document.querySelectorAll('.cascade-level');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });
      levels.forEach((level, i) => {
        level.style.transitionDelay = `${i * 0.08}s`;
        observer.observe(level);
      });
    }

    window.addEventListener('load', () => {
      cascadeReveal();
      setTimeout(() => switchDemo(0), 200);
    });
  </script>
</body>
</html>
