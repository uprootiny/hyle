<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hyle ~ creative coding</title>
  <style>
    @keyframes drift { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
    @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    @keyframes typing { from { width: 0; } to { width: 100%; } }

    :root {
      --bg: #1a1625;
      --fg: #e0def4;
      --rose: #eb6f92;
      --gold: #f6c177;
      --iris: #c4a7e7;
      --foam: #9ccfd8;
      --pine: #31748f;
      --surface: #26233a;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Space Mono', 'Fira Code', monospace;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    .dot {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      animation: drift 8s ease-in-out infinite;
    }

    main {
      position: relative;
      z-index: 1;
      padding: 2rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .hero {
      text-align: center;
      padding: 4rem 0 2rem;
    }
    h1 {
      font-size: clamp(2.5rem, 10vw, 5rem);
      font-weight: 400;
      letter-spacing: 0.15em;
      margin-bottom: 1rem;
    }
    h1 span:nth-child(1) { color: var(--rose); }
    h1 span:nth-child(2) { color: var(--gold); }
    h1 span:nth-child(3) { color: var(--iris); }
    h1 span:nth-child(4) { color: var(--foam); }

    .tagline {
      font-size: 1.1rem;
      color: var(--pine);
      margin-bottom: 2rem;
    }

    h2 {
      font-size: 1.1rem;
      color: var(--iris);
      margin-bottom: 1rem;
      font-weight: normal;
      text-align: center;
    }

    /* Prompt Composer */
    .composer {
      background: var(--surface);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
    }
    .composer-row {
      margin-bottom: 1rem;
    }
    .composer-label {
      font-size: 0.75rem;
      color: var(--pine);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .pill {
      padding: 0.4rem 0.9rem;
      border-radius: 20px;
      border: 1px solid;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      background: transparent;
      font-family: inherit;
    }
    .pill:hover { transform: scale(1.05); }
    .pill.selected { color: var(--bg) !important; }

    .pill[data-cat="type"] { border-color: var(--rose); color: var(--rose); }
    .pill[data-cat="type"].selected { background: var(--rose); }
    .pill[data-cat="visual"] { border-color: var(--gold); color: var(--gold); }
    .pill[data-cat="visual"].selected { background: var(--gold); }
    .pill[data-cat="physics"] { border-color: var(--foam); color: var(--foam); }
    .pill[data-cat="physics"].selected { background: var(--foam); }
    .pill[data-cat="color"] { border-color: var(--iris); color: var(--iris); }
    .pill[data-cat="color"].selected { background: var(--iris); }
    .pill[data-cat="export"] { border-color: var(--pine); color: var(--pine); }
    .pill[data-cat="export"].selected { background: var(--pine); }

    .composed-prompt {
      background: var(--bg);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      min-height: 60px;
      font-size: 0.85rem;
      color: var(--foam);
      line-height: 1.6;
    }
    .composed-prompt:empty::before {
      content: 'Select pills to compose your prompt...';
      color: var(--pine);
      opacity: 0.6;
    }
    .composer-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .composer-btn {
      padding: 0.6rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-generate {
      background: linear-gradient(135deg, var(--rose), var(--iris));
      color: var(--bg);
      flex: 1;
    }
    .btn-generate:hover { transform: scale(1.02); box-shadow: 0 4px 20px rgba(235, 111, 146, 0.3); }
    .btn-generate:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-clear {
      background: transparent;
      border: 1px solid var(--pine);
      color: var(--pine);
    }
    .btn-clear:hover { border-color: var(--fg); color: var(--fg); }
    .btn-copy {
      background: transparent;
      border: 1px solid var(--gold);
      color: var(--gold);
    }
    .btn-copy:hover { background: var(--gold); color: var(--bg); }

    /* Live Generation Preview */
    .generation-preview {
      background: var(--surface);
      border-radius: 12px;
      margin: 2rem 0;
      overflow: hidden;
      display: none;
    }
    .generation-preview.active { display: block; }
    .gen-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(0,0,0,0.2);
    }
    .gen-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--rose); }
    .gen-dot.generating { animation: pulse 0.5s infinite; background: var(--foam); }
    .gen-status { font-size: 0.8rem; color: var(--pine); }
    .gen-body {
      padding: 1rem;
      font-size: 0.85rem;
      max-height: 400px;
      overflow-y: auto;
    }
    .gen-line { margin: 0.25rem 0; opacity: 0; animation: fadeIn 0.3s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    .gen-file { color: var(--gold); }
    .gen-code { color: var(--fg); padding-left: 1rem; }
    .gen-action { color: var(--foam); }
    .gen-comment { color: var(--pine); font-style: italic; }

    /* Interactive demo canvas */
    .demo-canvas {
      width: 100%;
      height: 200px;
      background: var(--surface);
      border-radius: 12px;
      margin: 2rem 0;
      cursor: crosshair;
    }

    /* Project cards */
    .projects {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin: 3rem 0;
    }
    .project {
      background: var(--surface);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .project:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
    }
    .project-preview {
      height: 140px;
      background: linear-gradient(135deg, var(--rose), var(--iris));
      background-size: 200% 200%;
      animation: gradient 4s ease infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }
    .project:nth-child(2) .project-preview { background: linear-gradient(135deg, var(--gold), var(--foam)); }
    .project:nth-child(3) .project-preview { background: linear-gradient(135deg, var(--iris), var(--pine)); }
    .project:nth-child(4) .project-preview { background: linear-gradient(135deg, var(--foam), var(--rose)); }
    .project:nth-child(5) .project-preview { background: linear-gradient(135deg, var(--pine), var(--gold)); }
    .project:nth-child(6) .project-preview { background: linear-gradient(135deg, var(--rose), var(--foam)); }

    .project-info { padding: 1rem; }
    .project-title { font-size: 1rem; margin-bottom: 0.5rem; color: var(--fg); }
    .project-desc { font-size: 0.8rem; color: var(--pine); margin-bottom: 0.75rem; }
    .project-prompt {
      display: none;
      background: var(--bg);
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      color: var(--foam);
      margin-top: 0.75rem;
    }
    .project.expanded .project-prompt { display: block; }
    .project-actions { display: flex; gap: 0.5rem; }
    .project-btn {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 6px;
      font-size: 0.75rem;
      font-family: inherit;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-copy-proj { background: var(--pine); color: var(--fg); }
    .btn-copy-proj:hover { background: var(--foam); color: var(--bg); }
    .btn-expand { background: transparent; border: 1px solid var(--pine); color: var(--pine); }
    .btn-expand:hover { border-color: var(--iris); color: var(--iris); }

    /* Terminal demo */
    .terminal {
      background: #0d0d0d;
      border-radius: 12px;
      margin: 3rem 0;
      overflow: hidden;
    }
    .terminal-header {
      background: #1a1a1a;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .terminal-dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot-red { background: #ff5f56; }
    .dot-yellow { background: #ffbd2e; }
    .dot-green { background: #27c93f; }
    .terminal-title { flex: 1; text-align: center; font-size: 0.8rem; color: #666; }
    .terminal-body {
      padding: 1rem;
      font-size: 0.85rem;
      line-height: 1.6;
      height: 350px;
      overflow-y: auto;
    }
    .term-line { margin: 0.25rem 0; }
    .term-prompt { color: var(--rose); }
    .term-output { color: var(--pine); }
    .term-file { color: var(--gold); }
    .term-comment { color: #555; font-style: italic; }
    .term-cursor {
      display: inline-block;
      width: 8px;
      height: 1em;
      background: var(--fg);
      animation: pulse 1s infinite;
    }

    .terminal-controls {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: #1a1a1a;
      border-top: 1px solid #333;
    }
    .term-btn {
      padding: 0.4rem 1rem;
      background: var(--surface);
      border: none;
      border-radius: 4px;
      color: var(--fg);
      font-family: inherit;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .term-btn:hover { background: var(--pine); }

    .cta {
      text-align: center;
      margin: 4rem 0 2rem;
    }
    .cta a {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: transparent;
      border: 2px solid var(--iris);
      color: var(--iris);
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s;
    }
    .cta a:hover { background: var(--iris); color: var(--bg); }

    footer {
      text-align: center;
      padding: 2rem;
      color: var(--pine);
      font-size: 0.8rem;
    }
    footer a { color: var(--pine); }

    .variant-switcher { position: fixed; bottom: 1rem; right: 1rem; z-index: 100; }
    .switcher-toggle {
      width: 28px; height: 28px; border-radius: 50%;
      background: transparent; border: 1px solid var(--pine);
      color: var(--pine); cursor: pointer; font-size: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .switcher-toggle:hover { border-color: var(--iris); color: var(--iris); }
    .switcher-panel {
      display: none; position: absolute; bottom: 34px; right: 0;
      background: var(--bg); border: 1px solid var(--pine); padding: 0.5rem;
      min-width: 140px; border-radius: 8px;
    }
    .switcher-panel.open { display: block; }
    .switcher-item {
      display: block; padding: 0.4rem 0.75rem; color: var(--pine);
      font-size: 11px; text-decoration: none; border-radius: 4px;
    }
    .switcher-item:hover { color: var(--fg); background: rgba(255,255,255,0.05); }
    .switcher-item.active { color: var(--iris); }
  </style>
</head>
<body>
  <div class="canvas" id="canvas"></div>

  <main>
    <div class="hero">
      <h1><span>h</span><span>y</span><span>l</span><span>e</span></h1>
      <p class="tagline">describe it. watch it emerge.</p>
    </div>

    <h2>compose your vision</h2>
    <div class="composer">
      <div class="composer-row">
        <div class="composer-label">Type</div>
        <div class="pill-group">
          <button class="pill" data-cat="type" data-text="particle system">particles</button>
          <button class="pill" data-cat="type" data-text="shader">shader</button>
          <button class="pill" data-cat="type" data-text="physics simulation">physics</button>
          <button class="pill" data-cat="type" data-text="fractal">fractal</button>
          <button class="pill" data-cat="type" data-text="cellular automaton">automata</button>
          <button class="pill" data-cat="type" data-text="generative tree">l-system</button>
        </div>
      </div>
      <div class="composer-row">
        <div class="composer-label">Visual Style</div>
        <div class="pill-group">
          <button class="pill" data-cat="visual" data-text="with trails">trails</button>
          <button class="pill" data-cat="visual" data-text="with glow effect">glow</button>
          <button class="pill" data-cat="visual" data-text="wireframe">wireframe</button>
          <button class="pill" data-cat="visual" data-text="filled polygons">solid</button>
          <button class="pill" data-cat="visual" data-text="with blur">blur</button>
          <button class="pill" data-cat="visual" data-text="pixelated">pixel</button>
        </div>
      </div>
      <div class="composer-row">
        <div class="composer-label">Behavior</div>
        <div class="pill-group">
          <button class="pill" data-cat="physics" data-text="responding to mouse position">mouse reactive</button>
          <button class="pill" data-cat="physics" data-text="driven by audio FFT">audio reactive</button>
          <button class="pill" data-cat="physics" data-text="with perlin noise flow field">flow field</button>
          <button class="pill" data-cat="physics" data-text="with gravity and collision">physics</button>
          <button class="pill" data-cat="physics" data-text="orbiting a center point">orbital</button>
        </div>
      </div>
      <div class="composer-row">
        <div class="composer-label">Colors</div>
        <div class="pill-group">
          <button class="pill" data-cat="color" data-text="using rainbow hue cycling">rainbow</button>
          <button class="pill" data-cat="color" data-text="with viridis colormap">viridis</button>
          <button class="pill" data-cat="color" data-text="black and white only">monochrome</button>
          <button class="pill" data-cat="color" data-text="with neon cyberpunk palette">neon</button>
          <button class="pill" data-cat="color" data-text="earth tones palette">earth</button>
          <button class="pill" data-cat="color" data-text="velocity-based coloring">velocity</button>
        </div>
      </div>
      <div class="composer-row">
        <div class="composer-label">Output</div>
        <div class="pill-group">
          <button class="pill" data-cat="export" data-text="export frames as png sequence">png sequence</button>
          <button class="pill" data-cat="export" data-text="save as gif">gif</button>
          <button class="pill" data-cat="export" data-text="fullscreen mode">fullscreen</button>
          <button class="pill" data-cat="export" data-text="with fps counter">show fps</button>
        </div>
      </div>

      <div class="composed-prompt" id="composedPrompt"></div>

      <div class="composer-actions">
        <button class="composer-btn btn-clear" onclick="clearPills()">Clear</button>
        <button class="composer-btn btn-copy" onclick="copyComposed()">Copy</button>
        <button class="composer-btn btn-generate" id="generateBtn" onclick="generateFromComposed()" disabled>Generate</button>
      </div>
    </div>

    <div class="generation-preview" id="generationPreview">
      <div class="gen-header">
        <div class="gen-dot" id="genDot"></div>
        <span class="gen-status" id="genStatus">Generating...</span>
      </div>
      <div class="gen-body" id="genBody"></div>
    </div>

    <canvas class="demo-canvas" id="demoCanvas"></canvas>

    <h2>example projects</h2>
    <div class="projects">
      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">~</div>
        <div class="project-info">
          <h3 class="project-title">Particle Flow Field</h3>
          <p class="project-desc">Perlin noise driven particles with WebGL acceleration and color gradients based on velocity</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> create a particle system with 10000 particles following a perlin noise flow field. use webgl for rendering. color particles by their velocity magnitude using a viridis colormap. add mouse interaction to push particles away.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(0)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>

      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">*</div>
        <div class="project-info">
          <h3 class="project-title">Audio Reactive Rings</h3>
          <p class="project-desc">Concentric rings that pulse with FFT frequency bands, smooth interpolation between beats</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> build an audio visualizer with concentric rings. use web audio api to get FFT data. map low frequencies to inner rings, highs to outer. smooth the values with exponential decay. add bloom effect using offscreen canvas.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(1)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>

      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">#</div>
        <div class="project-info">
          <h3 class="project-title">Recursive Tree Generator</h3>
          <p class="project-desc">L-system based fractal trees with wind simulation and seasonal color transitions</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> implement an l-system tree generator. start with axiom "F" and rules F -> FF+[+F-F-F]-[-F+F+F]. add random angle variation for organic look. simulate wind with sinusoidal branch displacement. cycle colors through seasons.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(2)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>

      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">@</div>
        <div class="project-info">
          <h3 class="project-title">Reaction Diffusion</h3>
          <p class="project-desc">Gray-Scott model simulation with adjustable feed/kill rates and GPU compute shaders</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> implement gray-scott reaction diffusion. use webgl compute shaders for the simulation. expose feed rate (0.055) and kill rate (0.062) as sliders. render chemical A as brightness. add click to inject chemical B.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(3)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>

      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">%</div>
        <div class="project-info">
          <h3 class="project-title">Verlet Cloth Physics</h3>
          <p class="project-desc">Soft body cloth simulation with point constraints, gravity, and wind forces</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> create a cloth simulation using verlet integration. make a 30x30 grid of points connected by distance constraints. pin top row. add gravity and wind (oscillating horizontal force). solve constraints 3 times per frame. render as triangles.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(4)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>

      <div class="project" onclick="toggleProject(this)">
        <div class="project-preview">&</div>
        <div class="project-info">
          <h3 class="project-title">Metaball Shader</h3>
          <p class="project-desc">Isosurface rendering with marching squares, organic blob movement and glow effects</p>
          <div class="project-prompt">
            <strong>Prompt:</strong> implement 2d metaballs in a fragment shader. place 8 blobs with smooth movement using sin/cos. compute distance field as sum of (radius/distance). threshold at 1.0 for the surface. add inner glow using field gradient.
          </div>
          <div class="project-actions">
            <button class="project-btn btn-copy-proj" onclick="event.stopPropagation(); copyPrompt(5)">Copy prompt</button>
            <button class="project-btn btn-expand">Expand</button>
          </div>
        </div>
      </div>
    </div>

    <h2>watch it happen</h2>
    <div class="terminal">
      <div class="terminal-header">
        <span class="terminal-dot dot-red"></span>
        <span class="terminal-dot dot-yellow"></span>
        <span class="terminal-dot dot-green"></span>
        <span class="terminal-title">hyle ~ generative</span>
      </div>
      <div class="terminal-body" id="terminalBody"></div>
      <div class="terminal-controls">
        <button class="term-btn" onclick="playDemo()">Play</button>
        <button class="term-btn" onclick="pauseDemo()">Pause</button>
        <button class="term-btn" onclick="restartDemo()">Restart</button>
        <button class="term-btn" onclick="nextDemo()">Next</button>
      </div>
    </div>

    <div class="cta">
      <a href="https://github.com/uprootiny/hyle">start creating</a>
    </div>

    <footer>
      <a href="https://github.com/uprootiny/hyle">github</a> &middot; mit license &middot; built for makers
    </footer>
  </main>

  <div class="variant-switcher">
    <div class="switcher-toggle" onclick="document.getElementById('sp').classList.toggle('open')">*</div>
    <div class="switcher-panel" id="sp">
      <a class="switcher-item" href="index.html">Default</a>
      <a class="switcher-item" href="unix.html">Composable</a>
      <a class="switcher-item" href="velocity.html">Velocity</a>
      <a class="switcher-item" href="reliable.html">Reliable</a>
      <a class="switcher-item" href="depth.html">Depth</a>
      <a class="switcher-item active" href="playful.html">Playful</a>
      <a class="switcher-item" href="observable.html">Observable</a>
      <a class="switcher-item" href="community.html">Community</a>
      <a class="switcher-item" href="indie.html">Independent</a>
      <a class="switcher-item" href="learn.html">Learning</a>
      <a class="switcher-item" href="control.html">Control</a>
      <a class="switcher-item" href="secure.html">Secure</a>
      <a class="switcher-item" href="flow.html">Flow</a>
    </div>
  </div>

  <script>
    // Floating background dots
    const canvas = document.getElementById('canvas');
    const colors = ['#eb6f92', '#f6c177', '#c4a7e7', '#9ccfd8', '#31748f'];
    for (let i = 0; i < 30; i++) {
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.style.left = Math.random() * 100 + '%';
      dot.style.top = Math.random() * 100 + '%';
      dot.style.background = colors[Math.floor(Math.random() * colors.length)];
      dot.style.animationDelay = Math.random() * 8 + 's';
      dot.style.opacity = 0.3 + Math.random() * 0.4;
      canvas.appendChild(dot);
    }

    // Interactive demo canvas
    const demoCanvas = document.getElementById('demoCanvas');
    const ctx = demoCanvas.getContext('2d');
    let particles = [];
    let mouse = { x: 0, y: 0 };

    function resizeCanvas() {
      demoCanvas.width = demoCanvas.offsetWidth;
      demoCanvas.height = demoCanvas.offsetHeight;
      initParticles();
    }

    function initParticles() {
      particles = [];
      for (let i = 0; i < 200; i++) {
        particles.push({
          x: Math.random() * demoCanvas.width,
          y: Math.random() * demoCanvas.height,
          vx: (Math.random() - 0.5) * 2,
          vy: (Math.random() - 0.5) * 2,
          radius: Math.random() * 3 + 1,
          color: colors[Math.floor(Math.random() * colors.length)]
        });
      }
    }

    function animateParticles() {
      ctx.fillStyle = 'rgba(26, 22, 37, 0.1)';
      ctx.fillRect(0, 0, demoCanvas.width, demoCanvas.height);

      particles.forEach(p => {
        const dx = mouse.x - p.x;
        const dy = mouse.y - p.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < 150 && dist > 0) {
          p.vx += dx / dist * 0.5;
          p.vy += dy / dist * 0.5;
        }
        p.vx *= 0.98;
        p.vy *= 0.98;
        p.x += p.vx;
        p.y += p.vy;
        if (p.x < 0) p.x = demoCanvas.width;
        if (p.x > demoCanvas.width) p.x = 0;
        if (p.y < 0) p.y = demoCanvas.height;
        if (p.y > demoCanvas.height) p.y = 0;

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
      });
      requestAnimationFrame(animateParticles);
    }

    demoCanvas.addEventListener('mousemove', e => {
      const rect = demoCanvas.getBoundingClientRect();
      mouse.x = e.clientX - rect.left;
      mouse.y = e.clientY - rect.top;
    });

    resizeCanvas();
    animateParticles();
    window.addEventListener('resize', resizeCanvas);

    // Pill composer
    const selectedPills = new Map();

    document.querySelectorAll('.pill').forEach(pill => {
      pill.addEventListener('click', () => {
        const cat = pill.dataset.cat;
        const text = pill.dataset.text;

        // Deselect other pills in same category
        document.querySelectorAll(`.pill[data-cat="${cat}"]`).forEach(p => {
          p.classList.remove('selected');
          selectedPills.delete(p);
        });

        // Toggle this pill
        if (selectedPills.has(pill)) {
          selectedPills.delete(pill);
          pill.classList.remove('selected');
        } else {
          selectedPills.set(pill, text);
          pill.classList.add('selected');
        }

        updateComposedPrompt();
      });
    });

    function updateComposedPrompt() {
      const parts = [];
      const categories = ['type', 'visual', 'physics', 'color', 'export'];

      categories.forEach(cat => {
        document.querySelectorAll(`.pill[data-cat="${cat}"].selected`).forEach(pill => {
          parts.push(pill.dataset.text);
        });
      });

      const prompt = parts.length > 0
        ? `create a ${parts.join(' ')}`
        : '';

      document.getElementById('composedPrompt').textContent = prompt;
      document.getElementById('generateBtn').disabled = parts.length === 0;
    }

    function clearPills() {
      document.querySelectorAll('.pill').forEach(p => p.classList.remove('selected'));
      selectedPills.clear();
      updateComposedPrompt();
      document.getElementById('generationPreview').classList.remove('active');
    }

    function copyComposed() {
      const text = document.getElementById('composedPrompt').textContent;
      if (text) {
        navigator.clipboard.writeText(text);
        const btn = event.target;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 1500);
      }
    }

    // Generation simulation
    function generateFromComposed() {
      const prompt = document.getElementById('composedPrompt').textContent;
      if (!prompt) return;

      const preview = document.getElementById('generationPreview');
      const genBody = document.getElementById('genBody');
      const genDot = document.getElementById('genDot');
      const genStatus = document.getElementById('genStatus');

      preview.classList.add('active');
      genBody.innerHTML = '';
      genDot.classList.add('generating');
      genStatus.textContent = 'Generating...';

      // Parse prompt for generation
      const hasParticles = prompt.includes('particle');
      const hasShader = prompt.includes('shader');
      const hasPhysics = prompt.includes('physics');
      const hasAudio = prompt.includes('audio');
      const hasMouse = prompt.includes('mouse');
      const hasExport = prompt.includes('export') || prompt.includes('gif');

      const lines = [
        { type: 'action', text: `> ${prompt}`, delay: 0 },
        { type: 'comment', text: '# analyzing requirements...', delay: 400 },
        { type: 'action', text: '[read] Cargo.toml', delay: 800 },
        { type: 'action', text: '[read] src/main.rs', delay: 1000 },
      ];

      if (hasParticles) {
        lines.push({ type: 'action', text: '[write] src/particles.rs', delay: 1300 });
        lines.push({ type: 'code', text: 'pub struct Particle {', delay: 1400 });
        lines.push({ type: 'code', text: '    pos: Vec2,', delay: 1500 });
        lines.push({ type: 'code', text: '    vel: Vec2,', delay: 1600 });
        lines.push({ type: 'code', text: '    color: Color,', delay: 1700 });
        lines.push({ type: 'code', text: '}', delay: 1800 });
      }

      if (hasShader) {
        lines.push({ type: 'action', text: '[write] shaders/frag.glsl', delay: 1900 });
        lines.push({ type: 'code', text: 'void main() {', delay: 2000 });
        lines.push({ type: 'code', text: '    vec2 uv = gl_FragCoord.xy / resolution;', delay: 2100 });
        lines.push({ type: 'code', text: '    // compute effect...', delay: 2200 });
        lines.push({ type: 'code', text: '}', delay: 2300 });
      }

      if (hasAudio) {
        lines.push({ type: 'action', text: '[write] src/audio.rs', delay: 2400 });
        lines.push({ type: 'code', text: 'use cpal::traits::*;', delay: 2500 });
        lines.push({ type: 'code', text: 'use rustfft::FftPlanner;', delay: 2600 });
      }

      if (hasMouse) {
        lines.push({ type: 'action', text: '[patch] src/input.rs', delay: 2700 });
        lines.push({ type: 'code', text: 'fn handle_mouse(&mut self, pos: Vec2) {', delay: 2800 });
        lines.push({ type: 'code', text: '    self.mouse_pos = pos;', delay: 2900 });
        lines.push({ type: 'code', text: '}', delay: 3000 });
      }

      if (hasExport) {
        lines.push({ type: 'action', text: '[write] src/export.rs', delay: 3100 });
        lines.push({ type: 'code', text: 'use image::{ImageBuffer, Rgba};', delay: 3200 });
      }

      lines.push({ type: 'action', text: '[bash] cargo build --release', delay: 3400 });
      lines.push({ type: 'comment', text: 'Compiling creative_project v0.1.0', delay: 3700 });
      lines.push({ type: 'comment', text: 'Finished release [optimized] target(s)', delay: 4200 });
      lines.push({ type: 'action', text: '[bash] cargo run --release', delay: 4500 });
      lines.push({ type: 'comment', text: '# window opens with your creation', delay: 4800 });

      lines.forEach(line => {
        setTimeout(() => {
          const div = document.createElement('div');
          div.className = 'gen-line gen-' + line.type;
          div.textContent = line.text;
          div.style.animationDelay = '0s';
          genBody.appendChild(div);
          genBody.scrollTop = genBody.scrollHeight;
        }, line.delay);
      });

      setTimeout(() => {
        genDot.classList.remove('generating');
        genStatus.textContent = 'Complete';
      }, 5000);
    }

    // Project prompts
    const prompts = [
      'create a particle system with 10000 particles following a perlin noise flow field. use webgl for rendering. color particles by their velocity magnitude using a viridis colormap. add mouse interaction to push particles away.',
      'build an audio visualizer with concentric rings. use web audio api to get FFT data. map low frequencies to inner rings, highs to outer. smooth the values with exponential decay. add bloom effect using offscreen canvas.',
      'implement an l-system tree generator. start with axiom "F" and rules F -> FF+[+F-F-F]-[-F+F+F]. add random angle variation for organic look. simulate wind with sinusoidal branch displacement. cycle colors through seasons.',
      'implement gray-scott reaction diffusion. use webgl compute shaders for the simulation. expose feed rate (0.055) and kill rate (0.062) as sliders. render chemical A as brightness. add click to inject chemical B.',
      'create a cloth simulation using verlet integration. make a 30x30 grid of points connected by distance constraints. pin top row. add gravity and wind (oscillating horizontal force). solve constraints 3 times per frame. render as triangles.',
      'implement 2d metaballs in a fragment shader. place 8 blobs with smooth movement using sin/cos. compute distance field as sum of (radius/distance). threshold at 1.0 for the surface. add inner glow using field gradient.'
    ];

    function toggleProject(el) { el.classList.toggle('expanded'); }

    function copyPrompt(idx) {
      navigator.clipboard.writeText(prompts[idx]);
      const btn = event.target;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy prompt', 1500);
    }

    // Terminal demo
    const demos = [
      {
        lines: [
          { type: 'prompt', text: '> create a particle system that responds to audio' },
          { type: 'comment', text: '# hyle reads project structure...' },
          { type: 'output', text: '[read] src/main.rs' },
          { type: 'output', text: '[read] Cargo.toml' },
          { type: 'comment', text: '# analyzing audio processing requirements...' },
          { type: 'output', text: '[write] src/audio.rs' },
          { type: 'file', text: 'use cpal::traits::{DeviceTrait, HostTrait, StreamTrait};' },
          { type: 'file', text: 'use rustfft::{FftPlanner, num_complex::Complex};' },
          { type: 'file', text: '' },
          { type: 'file', text: 'pub struct AudioAnalyzer {' },
          { type: 'file', text: '    fft: Arc<dyn Fft<f32>>,' },
          { type: 'file', text: '    buffer: Vec<Complex<f32>>,' },
          { type: 'file', text: '    spectrum: Arc<Mutex<Vec<f32>>>,' },
          { type: 'file', text: '}' },
          { type: 'output', text: '[write] src/particles.rs' },
          { type: 'file', text: 'impl Particle {' },
          { type: 'file', text: '    pub fn update(&mut self, spectrum: &[f32]) {' },
          { type: 'file', text: '        let bass = spectrum[0..10].iter().sum::<f32>() / 10.0;' },
          { type: 'file', text: '        self.radius = self.base_radius * (1.0 + bass * 2.0);' },
          { type: 'file', text: '        self.velocity *= 1.0 + bass * 0.5;' },
          { type: 'file', text: '    }' },
          { type: 'file', text: '}' },
          { type: 'output', text: '[bash] cargo build --release' },
          { type: 'output', text: 'Compiling audio_particles v0.1.0' },
          { type: 'output', text: 'Finished release [optimized] target(s)' },
          { type: 'comment', text: '# done in 12 seconds' }
        ]
      },
      {
        lines: [
          { type: 'prompt', text: '> implement reaction diffusion with adjustable parameters' },
          { type: 'output', text: '[read] src/main.rs' },
          { type: 'comment', text: '# setting up Gray-Scott simulation...' },
          { type: 'output', text: '[write] src/simulation.rs' },
          { type: 'file', text: 'pub struct GrayScott {' },
          { type: 'file', text: '    grid_a: Vec<Vec<f32>>,' },
          { type: 'file', text: '    grid_b: Vec<Vec<f32>>,' },
          { type: 'file', text: '    feed: f32,  // default 0.055' },
          { type: 'file', text: '    kill: f32,  // default 0.062' },
          { type: 'file', text: '    da: f32,    // diffusion A: 1.0' },
          { type: 'file', text: '    db: f32,    // diffusion B: 0.5' },
          { type: 'file', text: '}' },
          { type: 'file', text: '' },
          { type: 'file', text: 'impl GrayScott {' },
          { type: 'file', text: '    pub fn step(&mut self) {' },
          { type: 'file', text: '        for y in 1..self.height-1 {' },
          { type: 'file', text: '            for x in 1..self.width-1 {' },
          { type: 'file', text: '                let a = self.grid_a[y][x];' },
          { type: 'file', text: '                let b = self.grid_b[y][x];' },
          { type: 'file', text: '                let lap_a = self.laplacian_a(x, y);' },
          { type: 'file', text: '                let lap_b = self.laplacian_b(x, y);' },
          { type: 'file', text: '                let reaction = a * b * b;' },
          { type: 'file', text: '                self.next_a[y][x] = a + self.da * lap_a - reaction + self.feed * (1.0 - a);' },
          { type: 'file', text: '                self.next_b[y][x] = b + self.db * lap_b + reaction - (self.kill + self.feed) * b;' },
          { type: 'file', text: '            }' },
          { type: 'file', text: '        }' },
          { type: 'file', text: '    }' },
          { type: 'file', text: '}' },
          { type: 'output', text: '[write] src/ui.rs' },
          { type: 'file', text: 'egui::Slider::new(&mut sim.feed, 0.01..=0.1).text("Feed Rate")' },
          { type: 'file', text: 'egui::Slider::new(&mut sim.kill, 0.01..=0.1).text("Kill Rate")' },
          { type: 'output', text: '[bash] cargo run' },
          { type: 'comment', text: '# patterns emerge...' }
        ]
      },
      {
        lines: [
          { type: 'prompt', text: '> add mouse repulsion to the flow field' },
          { type: 'output', text: '[read] src/flow_field.rs' },
          { type: 'comment', text: '# adding force calculation...' },
          { type: 'output', text: '[patch] src/flow_field.rs' },
          { type: 'file', text: 'pub fn apply_forces(&mut self, mouse: Vec2) {' },
          { type: 'file', text: '    for particle in &mut self.particles {' },
          { type: 'file', text: '        let delta = particle.pos - mouse;' },
          { type: 'file', text: '        let dist = delta.length();' },
          { type: 'file', text: '        if dist < 100.0 && dist > 0.0 {' },
          { type: 'file', text: '            let force = delta.normalize() * (100.0 - dist) * 0.1;' },
          { type: 'file', text: '            particle.vel += force;' },
          { type: 'file', text: '        }' },
          { type: 'file', text: '    }' },
          { type: 'file', text: '}' },
          { type: 'output', text: '[bash] cargo test' },
          { type: 'output', text: 'test flow_field::tests::repulsion_force ... ok' },
          { type: 'comment', text: '# particles now flee the cursor' }
        ]
      }
    ];

    let currentDemo = 0;
    let lineIndex = 0;
    let isPlaying = false;
    let playInterval = null;

    function renderLine(line) {
      const div = document.createElement('div');
      div.className = 'term-line';
      if (line.type === 'prompt') {
        div.innerHTML = `<span class="term-prompt">${line.text}</span>`;
      } else if (line.type === 'output') {
        div.innerHTML = `<span class="term-output">${line.text}</span>`;
      } else if (line.type === 'file') {
        div.innerHTML = `<span class="term-file">${line.text}</span>`;
      } else if (line.type === 'comment') {
        div.innerHTML = `<span class="term-comment">${line.text}</span>`;
      }
      return div;
    }

    function playDemo() {
      if (isPlaying) return;
      isPlaying = true;
      playInterval = setInterval(() => {
        if (lineIndex >= demos[currentDemo].lines.length) {
          pauseDemo();
          return;
        }
        const termBody = document.getElementById('terminalBody');
        termBody.appendChild(renderLine(demos[currentDemo].lines[lineIndex]));
        termBody.scrollTop = termBody.scrollHeight;
        lineIndex++;
      }, 150);
    }

    function pauseDemo() {
      isPlaying = false;
      if (playInterval) clearInterval(playInterval);
    }

    function restartDemo() {
      pauseDemo();
      lineIndex = 0;
      document.getElementById('terminalBody').innerHTML = '';
      playDemo();
    }

    function nextDemo() {
      pauseDemo();
      currentDemo = (currentDemo + 1) % demos.length;
      lineIndex = 0;
      document.getElementById('terminalBody').innerHTML = '';
      playDemo();
    }

    setTimeout(playDemo, 500);
  </script>
</body>
</html>
