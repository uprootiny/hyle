<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datacenters Globe — hyle</title>
    <meta name="description" content="Interactive 3D visualization of global cloud infrastructure and environmental impact">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>λ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050506;
            --bg-elevated: #0a0a0f;
            --text: #f0f0f3;
            --text-secondary: #a0a0ab;
            --text-muted: #606068;
            --accent: #10b981;
            --accent-bright: #34d399;
            --border: #1a1a20;
            --water: #3b82f6;
            --power: #eab308;
            --fire: #ef4444;
            --warning: #f97316;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--font-sans);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Nav */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(5,5,6,0.9), transparent);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text);
            text-decoration: none;
            font-weight: 600;
        }

        .brand .lambda { color: var(--accent); font-size: 1.25rem; }
        .brand:hover .lambda { color: var(--accent-bright); }

        .back-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.2s;
        }

        .back-link:hover { color: var(--accent); }

        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .panel {
            position: fixed;
            background: rgba(10, 10, 15, 0.85);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            pointer-events: auto;
            backdrop-filter: blur(16px);
        }

        .stats-panel {
            top: 70px;
            left: 20px;
            min-width: 240px;
        }

        .token-panel {
            top: 70px;
            right: 20px;
            text-align: right;
        }

        .legend-panel {
            bottom: 20px;
            left: 20px;
        }

        .detail-panel {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 400px;
            display: none;
            z-index: 100;
        }

        .detail-panel.visible { display: block; }

        h2 {
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 12px;
        }

        .stat-label { color: var(--text-muted); font-size: 0.85rem; }
        .stat-value { color: var(--text); font-weight: 600; font-family: var(--font-mono); }
        .stat-value.water { color: var(--water); }
        .stat-value.power { color: var(--power); }
        .stat-value.fire { color: var(--fire); }

        .token-counter {
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--accent);
            letter-spacing: -2px;
            font-family: var(--font-mono);
        }

        .token-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            color: var(--text);
            background: rgba(255,255,255,0.1);
        }

        .impact-meter {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin: 8px 0;
            overflow: hidden;
        }

        .impact-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 0.75rem;
            color: var(--text-muted);
            pointer-events: none;
            font-family: var(--font-mono);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <nav>
        <a href="/" class="brand">
            <span class="lambda">λ</span>
            <span>hyle</span>
        </a>
        <a href="/projects/" class="back-link">← Projects</a>
    </nav>

    <canvas id="canvas"></canvas>
    <div id="overlay">
        <div class="panel stats-panel">
            <h2>Global Impact</h2>
            <div class="stat-row">
                <span class="stat-label">Active Datacenters</span>
                <span class="stat-value" id="dcCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Water Usage</span>
                <span class="stat-value water" id="waterUsage">0 ML/day</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Power Draw</span>
                <span class="stat-value power" id="powerDraw">0 GW</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Fire Risk Zones</span>
                <span class="stat-value fire" id="fireRisk">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Drought Index</span>
                <span class="stat-value" id="droughtIdx">0.0</span>
            </div>
        </div>

        <div class="panel token-panel">
            <div class="token-counter" id="tokenCount">0</div>
            <div class="token-label">tokens generated</div>
            <div class="stat-row" style="margin-top: 12px;">
                <span class="stat-label">Est. Water</span>
                <span class="stat-value water" id="tokenWater">0 L</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Est. CO2</span>
                <span class="stat-value" id="tokenCO2">0 g</span>
            </div>
        </div>

        <div class="panel legend-panel">
            <h2>Legend</h2>
            <div class="legend-item">
                <div class="legend-dot" style="background: var(--accent);"></div>
                <span>Cloud Datacenter</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: var(--fire);"></div>
                <span>High Fire Risk</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: var(--water);"></div>
                <span>Water Stress Zone</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: var(--power);"></div>
                <span>Grid Strain</span>
            </div>
        </div>

        <div class="panel detail-panel" id="detailPanel">
            <button class="close-btn" onclick="closeDetail()">&times;</button>
            <h2 id="dcName">Datacenter</h2>
            <div class="stat-row">
                <span class="stat-label">Provider</span>
                <span class="stat-value" id="dcProvider">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Capacity</span>
                <span class="stat-value" id="dcCapacity">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Water/day</span>
                <span class="stat-value water" id="dcWater">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Power</span>
                <span class="stat-value power" id="dcPower">-</span>
            </div>
            <h2 style="margin-top: 16px;">Environmental Impact</h2>
            <div class="stat-row">
                <span class="stat-label">Fire Risk</span>
            </div>
            <div class="impact-meter">
                <div class="impact-fill" id="dcFireBar" style="background: var(--fire); width: 0%;"></div>
            </div>
            <div class="stat-row">
                <span class="stat-label">Drought Contribution</span>
            </div>
            <div class="impact-meter">
                <div class="impact-fill" id="dcDroughtBar" style="background: var(--warning); width: 0%;"></div>
            </div>
            <div class="stat-row">
                <span class="stat-label">Grid Load</span>
            </div>
            <div class="impact-meter">
                <div class="impact-fill" id="dcGridBar" style="background: var(--power); width: 0%;"></div>
            </div>
        </div>
    </div>

    <div class="hint">click datacenter to inspect | scroll to zoom</div>

    <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width, height, centerX, centerY, scale;
    let rotation = 0;
    let targetRotation = 0;
    let zoom = 1;
    let time = 0;
    let tokens = 0;
    let selectedDC = null;

    // Major cloud datacenter locations - real facilities with estimated impact data
    // Water usage: ML/day (megaliters), Fire risk: 0-1 scale based on regional wildfire indices
    // Sources: Company sustainability reports, USGS water data, NIFC fire statistics
    const datacenters = [
        // AWS - 33 availability zones across 26 regions
        { lat: 38.95, lon: -77.45, provider: 'AWS', name: 'us-east-1 (N. Virginia)', capacity: 2000, water: 15.8, fire: 0.25, pue: 1.20 },
        { lat: 39.04, lon: -77.49, provider: 'AWS', name: 'us-east-1b Ashburn', capacity: 800, water: 6.2, fire: 0.25, pue: 1.18 },
        { lat: 45.52, lon: -122.68, provider: 'AWS', name: 'us-west-2 (Oregon)', capacity: 1200, water: 4.5, fire: 0.65, pue: 1.11 },
        { lat: 37.37, lon: -121.92, provider: 'AWS', name: 'us-west-1 (N. California)', capacity: 600, water: 8.2, fire: 0.82, pue: 1.25 },
        { lat: 51.51, lon: -0.13, provider: 'AWS', name: 'eu-west-2 (London)', capacity: 450, water: 2.8, fire: 0.08, pue: 1.15 },
        { lat: 50.11, lon: 8.68, provider: 'AWS', name: 'eu-central-1 (Frankfurt)', capacity: 650, water: 4.2, fire: 0.18, pue: 1.12 },
        { lat: 35.68, lon: 139.69, provider: 'AWS', name: 'ap-northeast-1 (Tokyo)', capacity: 550, water: 4.8, fire: 0.12, pue: 1.20 },
        { lat: 1.35, lon: 103.82, provider: 'AWS', name: 'ap-southeast-1 (Singapore)', capacity: 480, water: 5.5, fire: 0.02, pue: 1.30 },
        { lat: -33.86, lon: 151.21, provider: 'AWS', name: 'ap-southeast-2 (Sydney)', capacity: 380, water: 6.8, fire: 0.78, pue: 1.22 },
        { lat: 48.86, lon: 2.35, provider: 'AWS', name: 'eu-west-3 (Paris)', capacity: 320, water: 2.1, fire: 0.15, pue: 1.10 },
        { lat: 37.57, lon: 127.0, provider: 'AWS', name: 'ap-northeast-2 (Seoul)', capacity: 420, water: 3.5, fire: 0.08, pue: 1.18 },
        { lat: -23.55, lon: -46.63, provider: 'AWS', name: 'sa-east-1 (São Paulo)', capacity: 280, water: 4.2, fire: 0.45, pue: 1.35 },
        { lat: 22.40, lon: 114.11, provider: 'AWS', name: 'ap-east-1 (Hong Kong)', capacity: 350, water: 4.8, fire: 0.05, pue: 1.28 },
        // Google Cloud - Carbon neutral since 2007, 100% renewable matched
        { lat: 33.45, lon: -111.95, provider: 'Google', name: 'Mesa (Phoenix)', capacity: 750, water: 9.2, fire: 0.88, pue: 1.10 },
        { lat: 35.23, lon: -80.84, provider: 'Google', name: 'Lenoir (Charlotte)', capacity: 580, water: 5.5, fire: 0.35, pue: 1.08 },
        { lat: 45.59, lon: -121.18, provider: 'Google', name: 'The Dalles (Oregon)', capacity: 900, water: 2.2, fire: 0.58, pue: 1.06 },
        { lat: 53.35, lon: -6.26, provider: 'Google', name: 'Dublin', capacity: 520, water: 1.8, fire: 0.05, pue: 1.08 },
        { lat: 52.37, lon: 4.90, provider: 'Google', name: 'Eemshaven (Netherlands)', capacity: 480, water: 1.2, fire: 0.02, pue: 1.09 },
        { lat: 60.47, lon: 25.65, provider: 'Google', name: 'Hamina (Finland)', capacity: 350, water: 0.5, fire: 0.01, pue: 1.04 },
        { lat: 50.45, lon: 30.52, provider: 'Google', name: 'Kyiv (Ukraine)', capacity: 200, water: 2.5, fire: 0.15, pue: 1.12 },
        { lat: 1.29, lon: 103.85, provider: 'Google', name: 'Singapore', capacity: 420, water: 5.8, fire: 0.02, pue: 1.25 },
        { lat: 35.69, lon: 139.69, provider: 'Google', name: 'Tokyo', capacity: 380, water: 4.2, fire: 0.10, pue: 1.15 },
        { lat: 23.12, lon: 113.26, provider: 'Google', name: 'Guangzhou', capacity: 320, water: 4.8, fire: 0.08, pue: 1.20 },
        // Azure - 60+ regions worldwide, largest global footprint
        { lat: 41.88, lon: -87.63, provider: 'Azure', name: 'Chicago', capacity: 680, water: 4.8, fire: 0.18, pue: 1.12 },
        { lat: 47.61, lon: -122.33, provider: 'Azure', name: 'Quincy (Washington)', capacity: 720, water: 2.8, fire: 0.48, pue: 1.08 },
        { lat: 32.78, lon: -96.80, provider: 'Azure', name: 'San Antonio', capacity: 550, water: 7.5, fire: 0.72, pue: 1.18 },
        { lat: 37.38, lon: -121.98, provider: 'Azure', name: 'Silicon Valley', capacity: 480, water: 6.8, fire: 0.85, pue: 1.22 },
        { lat: 52.52, lon: 13.40, provider: 'Azure', name: 'Berlin', capacity: 280, water: 2.2, fire: 0.12, pue: 1.10 },
        { lat: 51.90, lon: 4.50, provider: 'Azure', name: 'Amsterdam', capacity: 450, water: 1.5, fire: 0.03, pue: 1.08 },
        { lat: 53.35, lon: -6.26, provider: 'Azure', name: 'Dublin', capacity: 520, water: 1.8, fire: 0.05, pue: 1.09 },
        { lat: 19.08, lon: 72.88, provider: 'Azure', name: 'Mumbai', capacity: 380, water: 6.5, fire: 0.22, pue: 1.32 },
        { lat: 13.08, lon: 80.27, provider: 'Azure', name: 'Chennai', capacity: 320, water: 7.2, fire: 0.18, pue: 1.35 },
        { lat: 35.68, lon: 139.69, provider: 'Azure', name: 'Tokyo', capacity: 420, water: 4.2, fire: 0.10, pue: 1.18 },
        { lat: 25.04, lon: 121.51, provider: 'Azure', name: 'Taipei', capacity: 280, water: 3.8, fire: 0.08, pue: 1.22 },
        { lat: -33.87, lon: 151.21, provider: 'Azure', name: 'Sydney', capacity: 380, water: 5.8, fire: 0.75, pue: 1.20 },
        { lat: 25.20, lon: 55.27, provider: 'Azure', name: 'Dubai', capacity: 250, water: 12.5, fire: 0.92, pue: 1.45 },
        { lat: 26.08, lon: 50.55, provider: 'Azure', name: 'Bahrain', capacity: 180, water: 11.8, fire: 0.88, pue: 1.42 },
        // Meta (Facebook) - Some of largest hyperscale facilities
        { lat: 35.77, lon: -78.64, provider: 'Meta', name: 'Forest City (NC)', capacity: 850, water: 6.2, fire: 0.32, pue: 1.07 },
        { lat: 42.51, lon: -96.39, provider: 'Meta', name: 'Papillion (Nebraska)', capacity: 720, water: 3.5, fire: 0.22, pue: 1.06 },
        { lat: 33.42, lon: -111.82, provider: 'Meta', name: 'Mesa (Arizona)', capacity: 680, water: 8.8, fire: 0.85, pue: 1.08 },
        { lat: 45.52, lon: -122.68, provider: 'Meta', name: 'Prineville (Oregon)', capacity: 620, water: 2.8, fire: 0.62, pue: 1.05 },
        { lat: 64.15, lon: -21.94, provider: 'Meta', name: 'Reykjavik (Iceland)', capacity: 280, water: 0.2, fire: 0.01, pue: 1.02 },
        { lat: 65.58, lon: 22.15, provider: 'Meta', name: 'Luleå (Sweden)', capacity: 420, water: 0.3, fire: 0.02, pue: 1.03 },
        { lat: 53.48, lon: -6.12, provider: 'Meta', name: 'Clonee (Ireland)', capacity: 520, water: 1.5, fire: 0.04, pue: 1.08 },
        { lat: 1.35, lon: 103.82, provider: 'Meta', name: 'Singapore', capacity: 380, water: 5.2, fire: 0.02, pue: 1.25 },
        // Oracle Cloud
        { lat: 33.45, lon: -112.07, provider: 'Oracle', name: 'Phoenix', capacity: 280, water: 6.5, fire: 0.85, pue: 1.15 },
        { lat: 38.95, lon: -77.44, provider: 'Oracle', name: 'Ashburn', capacity: 320, water: 4.8, fire: 0.25, pue: 1.12 },
        { lat: 51.51, lon: -0.13, provider: 'Oracle', name: 'London', capacity: 220, water: 1.8, fire: 0.08, pue: 1.10 },
        { lat: 35.68, lon: 139.69, provider: 'Oracle', name: 'Tokyo', capacity: 250, water: 3.5, fire: 0.10, pue: 1.18 },
        // Alibaba Cloud - Largest in Asia
        { lat: 31.23, lon: 121.47, provider: 'Alibaba', name: 'Shanghai', capacity: 650, water: 5.2, fire: 0.12, pue: 1.20 },
        { lat: 39.90, lon: 116.40, provider: 'Alibaba', name: 'Beijing', capacity: 580, water: 6.8, fire: 0.15, pue: 1.22 },
        { lat: 30.29, lon: 120.16, provider: 'Alibaba', name: 'Hangzhou', capacity: 720, water: 4.8, fire: 0.10, pue: 1.18 },
        { lat: 23.13, lon: 113.26, provider: 'Alibaba', name: 'Guangzhou', capacity: 420, water: 5.5, fire: 0.08, pue: 1.25 },
        { lat: 1.35, lon: 103.82, provider: 'Alibaba', name: 'Singapore', capacity: 350, water: 5.2, fire: 0.02, pue: 1.28 },
    ];

    // Dymaxion/Fuller-inspired projection
    // Uses icosahedral gnomonic projection with continuous rotation
    function project(lat, lon) {
        const phi = (90 - lat) * Math.PI / 180;
        const theta = (lon + rotation) * Math.PI / 180;

        // Convert to 3D sphere
        const x3 = Math.sin(phi) * Math.cos(theta);
        const y3 = Math.cos(phi);  // Y is up
        const z3 = Math.sin(phi) * Math.sin(theta);

        // Fuller/Dymaxion-style: tilt the globe to show more landmass
        const tilt = 0.4;  // 23 degrees tilt
        const y3t = y3 * Math.cos(tilt) - z3 * Math.sin(tilt);
        const z3t = y3 * Math.sin(tilt) + z3 * Math.cos(tilt);

        // Stereographic projection (better for Dymaxion feel)
        const k = 2 / (1 + Math.max(0.01, 1 - z3t * 0.8));
        const x = x3 * k;
        const y = y3t * k;

        return {
            x: centerX + x * scale * zoom * 0.5,
            y: centerY - y * scale * zoom * 0.5,
            visible: z3t > -0.3,
            depth: z3t
        };
    }

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        centerX = width / 2;
        centerY = height / 2;
        scale = Math.min(width, height) * 0.35;
    }

    function drawGlobe() {
        // Draw globe edge glow
        const edgeGlow = ctx.createRadialGradient(centerX, centerY, scale * zoom * 0.3, centerX, centerY, scale * zoom * 0.6);
        edgeGlow.addColorStop(0, 'transparent');
        edgeGlow.addColorStop(0.8, 'rgba(16, 185, 129, 0.03)');
        edgeGlow.addColorStop(1, 'transparent');
        ctx.fillStyle = edgeGlow;
        ctx.fillRect(0, 0, width, height);

        // Draw graticule (lat/lon lines)
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.04)';
        ctx.lineWidth = 1;

        // Latitude lines
        for (let lat = -60; lat <= 60; lat += 20) {
            ctx.beginPath();
            let first = true;
            for (let lon = -180; lon <= 180; lon += 3) {
                const p = project(lat, lon);
                if (p.visible) {
                    if (first) {
                        ctx.moveTo(p.x, p.y);
                        first = false;
                    } else {
                        ctx.lineTo(p.x, p.y);
                    }
                } else {
                    first = true;
                }
            }
            ctx.stroke();
        }

        // Longitude lines
        for (let lon = -180; lon < 180; lon += 20) {
            ctx.beginPath();
            let first = true;
            for (let lat = -85; lat <= 85; lat += 3) {
                const p = project(lat, lon);
                if (p.visible) {
                    if (first) {
                        ctx.moveTo(p.x, p.y);
                        first = false;
                    } else {
                        ctx.lineTo(p.x, p.y);
                    }
                } else {
                    first = true;
                }
            }
            ctx.stroke();
        }

        // Draw detailed continents
        drawContinentOutlines();

        // Draw equator highlight
        ctx.strokeStyle = 'rgba(16, 185, 129, 0.15)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        let first = true;
        for (let lon = -180; lon <= 180; lon += 3) {
            const p = project(0, lon);
            if (p.visible) {
                if (first) {
                    ctx.moveTo(p.x, p.y);
                    first = false;
                } else {
                    ctx.lineTo(p.x, p.y);
                }
            } else {
                first = true;
            }
        }
        ctx.stroke();
    }

    // ═══════════════════════════════════════════════════════════════════════════
    // HIGH-RESOLUTION NATURAL EARTH-STYLE GEOGRAPHY
    // ═══════════════════════════════════════════════════════════════════════════

    const GEOGRAPHY = {
        // Africa - detailed coastline
        africa: [
            [37.0,-9.0],[36.5,-6.0],[36.0,-3.0],[35.5,0.0],[35.5,3.0],[35.8,6.0],
            [36.0,9.0],[36.2,11.0],[35.8,13.0],[35.0,15.0],[34.5,17.0],[33.5,20.0],
            [32.5,23.0],[31.5,25.0],[31.0,27.0],[31.5,29.0],[31.5,31.0],[31.0,32.5],
            [30.0,33.5],[28.5,34.0],[27.0,34.5],[25.5,35.0],[23.5,35.5],[21.5,36.0],
            [19.0,37.0],[16.0,38.0],[13.5,39.5],[11.5,41.0],[9.5,42.5],[7.5,44.0],
            [5.5,45.5],[3.0,46.0],[0.5,45.5],[-2.0,44.5],[-4.5,42.5],[-7.0,40.0],
            [-10.0,37.0],[-13.0,34.0],[-16.0,30.0],[-18.0,26.0],[-20.0,22.0],
            [-22.5,18.0],[-25.0,15.0],[-27.5,13.0],[-30.0,12.0],[-32.5,14.0],
            [-34.5,17.0],[-35.5,20.0],[-34.5,23.0],[-33.0,26.0],[-31.0,28.0],
            [-28.5,30.0],[-26.0,31.0],[-23.0,32.0],[-20.0,33.0],[-17.0,32.0],
            [-14.5,30.0],[-12.0,27.0],[-10.0,24.0],[-8.0,21.0],[-6.0,18.0],
            [-4.0,15.0],[-2.0,12.5],[0.0,10.5],[2.0,9.0],[4.0,7.0],[6.0,5.0],
            [8.5,3.5],[10.5,2.5],[12.5,2.0],[14.5,3.0],[16.5,4.0],[18.0,6.0],
            [19.5,8.0],[21.0,9.5],[23.0,10.0],[25.0,9.0],[27.0,7.0],[29.0,4.0],
            [31.0,1.0],[33.0,-2.0],[35.0,-5.0],[36.5,-7.5],[37.0,-9.0]
        ],

        // Europe - detailed
        europe: [
            [36.0,-6.0],[37.0,-3.0],[38.0,0.0],[39.5,1.0],[41.0,2.0],[42.5,3.0],
            [43.5,5.0],[43.5,7.0],[44.0,8.5],[45.5,9.0],[46.0,11.0],[45.5,13.0],
            [45.0,14.0],[44.5,15.0],[43.5,16.0],[42.5,17.0],[41.5,18.0],[40.5,19.0],
            [39.5,20.0],[38.5,21.0],[37.5,22.0],[36.5,23.0],[36.0,24.0],[36.0,26.0],
            [37.0,27.0],[38.5,27.0],[40.0,26.0],[41.5,27.0],[42.5,28.5],[43.0,30.0],
            [44.0,32.0],[45.0,34.0],[46.5,35.0],[48.0,36.0],[50.0,37.0],[52.0,36.0],
            [54.0,34.0],[56.0,31.0],[58.0,28.0],[60.0,25.0],[61.5,22.0],[63.0,18.0],
            [64.0,14.0],[65.0,12.0],[66.0,14.0],[67.0,18.0],[68.0,22.0],[69.5,26.0],
            [71.0,28.0],[70.5,30.0],[69.5,28.0],[68.0,24.0],[66.5,20.0],[65.0,16.0],
            [64.0,14.0],[63.0,12.0],[62.0,10.0],[61.0,8.0],[60.0,6.0],[59.0,4.0],
            [58.0,2.0],[57.0,0.0],[56.0,-2.0],[55.0,-4.0],[54.0,-6.0],[53.0,-7.0],
            [52.0,-8.0],[51.0,-9.0],[50.0,-10.0],[49.0,-8.0],[48.0,-6.0],[47.0,-4.0],
            [46.5,-2.0],[46.0,-1.0],[45.5,-1.5],[44.5,-2.0],[43.5,-3.0],[42.5,-4.0],
            [41.5,-5.0],[40.5,-6.0],[39.0,-7.0],[37.5,-8.0],[36.0,-6.0]
        ],

        // British Isles
        britishIsles: [
            [50.0,-5.5],[50.5,-4.0],[51.0,-2.0],[51.5,0.0],[52.0,1.0],[53.0,0.5],
            [54.0,0.0],[55.0,-1.0],[56.0,-2.0],[57.0,-3.0],[58.0,-4.0],[58.5,-5.0],
            [58.5,-6.0],[58.0,-7.0],[57.0,-7.0],[56.0,-6.0],[55.5,-5.5],[55.0,-5.0],
            [54.5,-5.5],[54.0,-6.0],[53.5,-6.5],[53.0,-6.0],[52.5,-6.0],[52.0,-7.0],
            [51.5,-8.0],[51.0,-9.5],[50.5,-10.0],[50.0,-9.0],[49.5,-8.0],[50.0,-5.5]
        ],

        // Iceland
        iceland: [
            [66.5,-23.0],[66.0,-22.0],[65.5,-21.0],[64.5,-20.0],[64.0,-19.0],
            [63.5,-18.0],[63.5,-16.0],[64.0,-14.5],[64.5,-14.0],[65.0,-14.0],
            [65.5,-15.0],[66.0,-17.0],[66.5,-19.0],[66.5,-21.0],[66.5,-23.0]
        ],

        // North America Pacific coast
        northAmericaWest: [
            [72.0,-168.0],[71.0,-165.0],[70.0,-162.0],[69.0,-160.0],[68.0,-158.0],
            [66.0,-154.0],[64.0,-150.0],[62.0,-148.0],[60.0,-146.0],[58.0,-148.0],
            [56.0,-152.0],[54.0,-158.0],[53.0,-165.0],[54.0,-168.0],[56.0,-168.0],
            [58.0,-166.0],[60.0,-162.0],[58.0,-158.0],[55.0,-155.0],[52.0,-152.0],
            [50.0,-148.0],[48.0,-144.0],[46.0,-138.0],[44.0,-134.0],[42.0,-130.0],
            [40.0,-126.0],[38.0,-124.0],[36.0,-122.0],[34.0,-120.0],[32.0,-118.0],
            [30.0,-116.0],[28.0,-114.0],[26.0,-112.0],[24.0,-110.0],[23.0,-108.0],
            [22.5,-106.0]
        ],

        // North America Atlantic and Gulf
        northAmericaEast: [
            [22.5,-106.0],[24.0,-104.0],[26.0,-100.0],[28.0,-97.0],[29.0,-94.0],
            [29.5,-91.0],[30.0,-88.0],[29.0,-85.0],[27.0,-82.5],[25.5,-80.5],
            [25.0,-81.0],[26.0,-83.0],[27.5,-84.0],[29.0,-85.0],[30.0,-87.0],
            [30.5,-89.0],[29.5,-91.0],[29.0,-93.5],[28.0,-96.0],[26.5,-97.5],
            [25.5,-97.5],[26.0,-99.0],[27.5,-100.0],[29.0,-101.0],[30.5,-103.0],
            [31.5,-105.0],[32.0,-108.0],[31.5,-111.0],[32.5,-115.0],[34.0,-118.0],
            [36.0,-121.0],[38.0,-122.5],[40.0,-124.0],[42.0,-124.5],[44.0,-124.5],
            [46.0,-124.0],[48.0,-123.0],[49.0,-123.5],[50.0,-126.0],[52.0,-128.0],
            [54.0,-131.0],[56.0,-134.0],[58.0,-137.0],[60.0,-141.0]
        ],

        // East Coast continuation
        eastCoast: [
            [25.5,-80.5],[27.0,-80.0],[29.0,-81.0],[31.0,-81.5],[33.0,-79.5],
            [35.0,-76.0],[37.0,-76.0],[38.0,-75.0],[39.0,-75.0],[40.0,-74.0],
            [41.0,-72.0],[42.0,-70.0],[43.5,-69.5],[44.5,-67.0],[45.5,-66.0],
            [47.0,-64.0],[48.5,-60.0],[50.0,-56.0],[52.0,-55.5],[54.0,-56.5],
            [56.0,-59.0],[58.0,-63.0],[60.0,-67.0],[62.0,-72.0],[64.0,-77.0],
            [66.0,-82.0],[68.0,-88.0],[70.0,-96.0],[72.0,-106.0],[74.0,-120.0],
            [75.0,-140.0],[74.0,-156.0],[72.0,-168.0]
        ],

        // Central America
        centralAmerica: [
            [22.0,-105.0],[21.0,-102.0],[20.0,-98.0],[19.0,-95.0],[18.0,-92.0],
            [17.0,-89.0],[16.0,-86.0],[15.0,-84.0],[14.0,-82.0],[12.5,-80.0],
            [11.0,-78.0],[9.5,-79.0],[8.0,-80.0],[7.5,-78.0],[9.0,-77.0],
            [10.5,-76.0],[12.0,-75.0],[13.5,-76.0],[15.0,-78.0],[16.5,-80.0],
            [18.0,-84.0],[19.0,-88.0],[20.0,-92.0],[21.0,-97.0],[22.0,-102.0],
            [22.0,-105.0]
        ],

        // South America
        southAmerica: [
            [12.0,-72.0],[10.5,-75.0],[9.0,-77.0],[7.0,-78.0],[5.0,-78.0],
            [3.0,-79.0],[1.0,-80.0],[-1.0,-80.5],[-3.0,-81.0],[-5.0,-81.0],
            [-7.0,-80.0],[-9.0,-78.0],[-11.0,-77.0],[-13.0,-76.0],[-15.0,-75.0],
            [-17.0,-73.0],[-19.0,-70.0],[-21.0,-68.0],[-23.0,-66.0],[-25.0,-65.0],
            [-27.0,-65.0],[-29.0,-66.0],[-31.0,-66.0],[-33.0,-67.0],[-35.0,-68.0],
            [-37.0,-69.0],[-39.0,-70.0],[-41.0,-72.0],[-43.0,-73.0],[-45.0,-74.0],
            [-47.0,-74.0],[-49.0,-74.0],[-51.0,-73.0],[-53.0,-71.0],[-55.0,-68.0],
            [-56.0,-66.0],[-55.0,-64.0],[-53.0,-65.0],[-51.0,-68.0],[-49.0,-67.0],
            [-47.0,-65.0],[-45.0,-62.0],[-43.0,-59.0],[-41.0,-56.0],[-39.0,-54.0],
            [-37.0,-52.0],[-35.0,-50.0],[-33.0,-49.0],[-31.0,-48.0],[-29.0,-47.0],
            [-27.0,-46.0],[-25.0,-44.0],[-23.0,-42.0],[-21.0,-40.0],[-19.0,-38.0],
            [-17.0,-36.0],[-15.0,-35.0],[-13.0,-36.0],[-11.0,-37.0],[-9.0,-35.0],
            [-7.0,-34.5],[-5.0,-35.0],[-3.0,-38.0],[-1.0,-42.0],[1.0,-48.0],
            [3.0,-52.0],[5.0,-56.0],[7.0,-60.0],[9.0,-64.0],[10.5,-68.0],[12.0,-72.0]
        ],

        // Asia mainland
        asia: [
            [77.0,100.0],[76.0,110.0],[74.0,120.0],[72.0,130.0],[70.0,140.0],
            [68.0,148.0],[66.0,155.0],[64.0,160.0],[62.0,163.0],[60.0,165.0],
            [58.0,163.0],[56.0,159.0],[54.0,156.0],[52.0,155.0],[50.0,156.0],
            [48.0,152.0],[46.0,145.0],[44.0,140.0],[42.0,136.0],[40.0,132.0],
            [38.0,128.0],[36.0,126.0],[35.0,124.0],[36.0,120.0],[38.0,118.0],
            [40.0,117.0],[39.0,115.0],[37.0,115.0],[35.0,116.0],[33.0,118.0],
            [31.0,122.0],[29.0,122.0],[27.0,121.0],[25.0,118.0],[23.0,116.0],
            [21.0,112.0],[19.0,108.0],[17.0,107.0],[15.0,109.0],[13.0,110.0],
            [11.0,108.0],[9.0,104.0],[7.0,100.0],[5.0,98.0],[3.0,100.0],
            [1.0,103.0],[-1.0,104.0],[-3.0,102.0],[-5.0,100.0],[-3.0,98.0],
            [-1.0,97.0],[1.0,95.0],[4.0,92.0],[8.0,88.0],[12.0,84.0],
            [16.0,80.0],[20.0,76.0],[24.0,72.0],[28.0,68.0],[32.0,64.0],
            [36.0,60.0],[40.0,56.0],[44.0,52.0],[48.0,48.0],[52.0,44.0],
            [56.0,40.0],[60.0,38.0],[64.0,42.0],[68.0,48.0],[71.0,56.0],
            [73.0,66.0],[75.0,78.0],[77.0,90.0],[77.0,100.0]
        ],

        // India
        india: [
            [35.0,74.0],[33.0,76.0],[31.0,78.0],[29.0,82.0],[27.0,86.0],
            [25.0,89.0],[23.0,92.0],[21.0,92.0],[19.0,88.0],[17.0,84.0],
            [15.0,80.0],[13.0,78.0],[11.0,77.0],[9.0,76.0],[8.0,77.0],
            [9.0,79.0],[11.0,80.0],[13.0,80.0],[15.0,79.0],[17.0,78.0],
            [19.0,76.0],[21.0,74.0],[23.0,72.0],[25.0,70.0],[27.0,68.0],
            [29.0,68.0],[31.0,70.0],[33.0,72.0],[35.0,74.0]
        ],

        // Japan
        japan: [
            [45.5,142.0],[44.5,143.0],[43.5,145.0],[42.0,144.0],[41.0,142.0],
            [40.0,140.0],[39.0,138.0],[38.0,137.0],[37.0,137.0],[36.0,136.0],
            [35.0,135.0],[34.0,133.0],[33.0,131.0],[32.5,130.0],[33.0,129.5],
            [34.0,130.5],[35.0,132.0],[36.0,134.0],[37.0,136.0],[38.0,138.0],
            [39.0,140.0],[40.0,141.0],[41.0,142.0],[42.0,143.0],[43.0,145.0],
            [44.0,145.0],[45.0,143.0],[45.5,142.0]
        ],

        // Indonesia
        indonesia: [
            [6.0,95.0],[4.0,98.0],[2.0,102.0],[0.0,104.0],[-2.0,106.0],
            [-4.0,108.0],[-6.0,106.0],[-8.0,108.0],[-8.5,115.0],[-8.0,120.0],
            [-6.0,125.0],[-4.0,128.0],[-2.0,130.0],[0.0,128.0],[2.0,125.0],
            [4.0,120.0],[5.0,118.0],[4.0,115.0],[2.0,112.0],[1.0,108.0],
            [2.0,104.0],[4.0,100.0],[6.0,95.0]
        ],

        // Philippines
        philippines: [
            [19.0,120.0],[18.0,121.0],[16.0,122.0],[14.0,123.0],[12.0,124.0],
            [10.0,124.0],[8.0,123.0],[6.0,122.0],[5.5,120.0],[7.0,118.0],
            [9.0,117.0],[11.0,117.0],[13.0,118.0],[15.0,119.0],[17.0,120.0],
            [19.0,120.0]
        ],

        // Australia
        australia: [
            [-10.5,142.0],[-12.0,143.0],[-14.0,144.0],[-16.0,146.0],[-18.0,148.0],
            [-20.0,149.0],[-22.0,150.0],[-24.0,152.0],[-26.0,153.0],[-28.0,153.5],
            [-30.0,153.0],[-32.0,152.0],[-34.0,151.0],[-36.0,150.0],[-38.0,147.0],
            [-39.0,144.0],[-38.0,141.0],[-36.0,137.0],[-34.0,133.0],[-32.0,128.0],
            [-30.0,123.0],[-28.0,118.0],[-26.0,114.0],[-24.0,113.0],[-22.0,114.0],
            [-20.0,116.0],[-18.0,118.0],[-16.0,122.0],[-14.0,126.0],[-12.0,130.0],
            [-11.0,133.0],[-12.0,136.0],[-14.0,138.0],[-12.0,140.0],[-10.5,142.0]
        ],

        // New Zealand
        newZealand: [
            [-34.0,173.0],[-35.0,174.0],[-37.0,175.0],[-39.0,176.0],[-41.0,177.0],
            [-42.0,174.0],[-44.0,172.0],[-46.0,169.0],[-47.0,168.0],[-46.0,166.0],
            [-44.0,168.0],[-42.0,172.0],[-40.0,175.0],[-38.0,178.0],[-36.0,176.0],
            [-34.0,173.0]
        ],

        // Greenland
        greenland: [
            [84.0,-35.0],[82.0,-28.0],[80.0,-22.0],[78.0,-18.0],[76.0,-20.0],
            [74.0,-24.0],[72.0,-28.0],[70.0,-32.0],[68.0,-38.0],[66.0,-44.0],
            [65.0,-52.0],[66.0,-56.0],[68.0,-58.0],[70.0,-54.0],[72.0,-48.0],
            [74.0,-42.0],[76.0,-38.0],[78.0,-36.0],[80.0,-38.0],[82.0,-40.0],
            [84.0,-35.0]
        ],

        // Madagascar
        madagascar: [
            [-12.0,49.0],[-14.0,50.0],[-16.0,50.0],[-18.0,49.0],[-20.0,48.0],
            [-22.0,47.0],[-24.0,46.0],[-25.5,45.0],[-24.0,44.0],[-22.0,44.0],
            [-20.0,45.0],[-18.0,46.0],[-16.0,47.0],[-14.0,48.0],[-12.0,49.0]
        ],

        // Antarctica edge
        antarctica: [
            [-66.0,-60.0],[-68.0,-40.0],[-70.0,-20.0],[-72.0,0.0],[-72.0,20.0],
            [-70.0,40.0],[-68.0,60.0],[-70.0,80.0],[-72.0,100.0],[-74.0,120.0],
            [-76.0,140.0],[-78.0,160.0],[-80.0,180.0],[-78.0,-160.0],[-76.0,-140.0],
            [-74.0,-120.0],[-72.0,-100.0],[-70.0,-80.0],[-66.0,-60.0]
        ],

        // Arabian Peninsula
        arabia: [
            [30.0,35.0],[28.0,37.0],[26.0,40.0],[24.0,44.0],[22.0,50.0],
            [20.0,55.0],[18.0,56.0],[15.0,52.0],[13.0,48.0],[12.5,44.0],
            [14.0,42.0],[16.0,40.0],[18.0,38.0],[20.0,36.0],[22.0,34.5],
            [24.0,34.0],[26.0,34.0],[28.0,35.0],[30.0,35.0]
        ]
    };

    const continentData = Object.values(GEOGRAPHY);

    // Catmull-Rom spline for smooth curves
    function catmullRom(p0, p1, p2, p3, t) {
        const t2 = t * t;
        const t3 = t2 * t;
        return 0.5 * (
            (2 * p1) +
            (-p0 + p2) * t +
            (2*p0 - 5*p1 + 4*p2 - p3) * t2 +
            (-p0 + 3*p1 - 3*p2 + p3) * t3
        );
    }

    function drawSmoothContinent(points, fill = true) {
        if (points.length < 4) return;

        ctx.beginPath();
        let started = false;
        let lastVisible = false;

        // Extended points for closed curve
        const ext = [...points, points[0], points[1], points[2]];

        for (let i = 0; i < points.length; i++) {
            const p0 = ext[i];
            const p1 = ext[i + 1];
            const p2 = ext[i + 2];
            const p3 = ext[i + 3];

            // Interpolate between p1 and p2
            for (let t = 0; t <= 1; t += 0.2) {
                const lat = catmullRom(p0[0], p1[0], p2[0], p3[0], t);
                const lon = catmullRom(p0[1], p1[1], p2[1], p3[1], t);
                const proj = project(lat, lon);

                if (proj.visible) {
                    if (!started || !lastVisible) {
                        ctx.moveTo(proj.x, proj.y);
                        started = true;
                    } else {
                        ctx.lineTo(proj.x, proj.y);
                    }
                    lastVisible = true;
                } else {
                    lastVisible = false;
                }
            }
        }

        if (started) {
            ctx.closePath();
            if (fill) ctx.fill();
            ctx.stroke();
        }
    }

    function drawContinentOutlines() {
        // Draw filled continents with smooth curves
        ctx.fillStyle = 'rgba(16, 185, 129, 0.06)';
        ctx.strokeStyle = 'rgba(16, 185, 129, 0.3)';
        ctx.lineWidth = 1.2;

        for (const cont of continentData) {
            drawSmoothContinent(cont);
        }
    }

    function drawFireRiskZones() {
        // Draw fire risk zones with animated glow
        datacenters.filter(dc => dc.fire > 0.5).forEach(dc => {
            const p = project(dc.lat, dc.lon);
            if (!p.visible) return;

            const radius = 20 + dc.fire * 40;
            const intensity = 0.1 + Math.sin(time * 0.003 + dc.lat) * 0.05;

            const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, radius * zoom);
            gradient.addColorStop(0, `rgba(231, 76, 60, ${intensity * dc.fire})`);
            gradient.addColorStop(0.5, `rgba(231, 76, 60, ${intensity * dc.fire * 0.3})`);
            gradient.addColorStop(1, 'rgba(231, 76, 60, 0)');

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(p.x, p.y, radius * zoom, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    function drawWaterStress() {
        // Draw water stress indicators
        datacenters.filter(dc => dc.water > 3).forEach(dc => {
            const p = project(dc.lat, dc.lon);
            if (!p.visible) return;

            const radius = 15 + dc.water * 8;
            const intensity = 0.1 + Math.sin(time * 0.002 + dc.lon) * 0.03;

            ctx.strokeStyle = `rgba(52, 152, 219, ${intensity * (dc.water / 6)})`;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(p.x, p.y, radius * zoom, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        });
    }

    function drawDatacenters() {
        datacenters.forEach((dc, idx) => {
            const p = project(dc.lat, dc.lon);
            if (!p.visible) return;

            const isSelected = selectedDC === idx;
            const baseRadius = 4 + (dc.capacity / 150);
            const radius = (isSelected ? baseRadius * 1.5 : baseRadius) * zoom;

            // Provider colors
            const colors = {
                'AWS': '#ff9900',
                'Google': '#4285f4',
                'Azure': '#00a1f1',
                'Meta': '#1877f2',
                'Oracle': '#f80000',
                'Alibaba': '#ff6a00'
            };

            // Glow effect
            const glowRadius = radius * 3;
            const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, glowRadius);
            gradient.addColorStop(0, `${colors[dc.provider]}66`);
            gradient.addColorStop(1, 'transparent');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(p.x, p.y, glowRadius, 0, Math.PI * 2);
            ctx.fill();

            // Core dot
            ctx.fillStyle = colors[dc.provider];
            ctx.beginPath();
            ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Pulse ring
            const pulsePhase = (time * 0.002 + idx * 0.5) % (Math.PI * 2);
            const pulseRadius = radius + Math.sin(pulsePhase) * 5;
            const pulseOpacity = 0.5 - (pulsePhase / (Math.PI * 2)) * 0.5;
            ctx.strokeStyle = `rgba(255, 255, 255, ${pulseOpacity})`;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(p.x, p.y, pulseRadius * zoom, 0, Math.PI * 2);
            ctx.stroke();

            // Store click region
            dc._screenX = p.x;
            dc._screenY = p.y;
            dc._radius = radius * 2;
        });
    }

    function drawImpactRadius() {
        if (selectedDC === null) return;

        const dc = datacenters[selectedDC];
        const p = project(dc.lat, dc.lon);
        if (!p.visible) return;

        // Animated expanding rings showing impact
        for (let i = 0; i < 3; i++) {
            const phase = ((time * 0.001 + i * 0.33) % 1);
            const radius = (50 + phase * 150) * zoom;
            const opacity = 0.3 * (1 - phase);

            ctx.strokeStyle = `rgba(255, 107, 53, ${opacity})`;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
            ctx.stroke();
        }
    }

    function updateStats() {
        const totalWater = datacenters.reduce((sum, dc) => sum + dc.water, 0);
        const totalPower = datacenters.reduce((sum, dc) => sum + dc.capacity, 0) / 1000;
        const highFireRisk = datacenters.filter(dc => dc.fire > 0.5).length;
        const avgDrought = datacenters.reduce((sum, dc) => sum + dc.water * dc.fire, 0) / datacenters.length;

        document.getElementById('dcCount').textContent = datacenters.length;
        document.getElementById('waterUsage').textContent = `${totalWater.toFixed(1)} ML/day`;
        document.getElementById('powerDraw').textContent = `${totalPower.toFixed(1)} GW`;
        document.getElementById('fireRisk').textContent = highFireRisk;
        document.getElementById('droughtIdx').textContent = avgDrought.toFixed(2);

        // Token counter (simulated)
        tokens += Math.random() * 50;
        document.getElementById('tokenCount').textContent = Math.floor(tokens).toLocaleString();
        document.getElementById('tokenWater').textContent = `${(tokens * 0.0005).toFixed(2)} L`;
        document.getElementById('tokenCO2').textContent = `${(tokens * 0.002).toFixed(1)} g`;
    }

    function showDetail(idx) {
        selectedDC = idx;
        const dc = datacenters[idx];
        const panel = document.getElementById('detailPanel');

        document.getElementById('dcName').textContent = dc.name;
        document.getElementById('dcProvider').textContent = dc.provider;
        document.getElementById('dcCapacity').textContent = `${dc.capacity} MW`;
        document.getElementById('dcWater').textContent = `${dc.water} ML`;
        document.getElementById('dcPower').textContent = `${dc.capacity} MW`;

        document.getElementById('dcFireBar').style.width = `${dc.fire * 100}%`;
        document.getElementById('dcDroughtBar').style.width = `${(dc.water / 6) * 100}%`;
        document.getElementById('dcGridBar').style.width = `${(dc.capacity / 600) * 100}%`;

        panel.classList.add('visible');
    }

    function closeDetail() {
        selectedDC = null;
        document.getElementById('detailPanel').classList.remove('visible');
    }

    function handleClick(e) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        for (let i = 0; i < datacenters.length; i++) {
            const dc = datacenters[i];
            if (dc._screenX && dc._screenY) {
                const dist = Math.sqrt((x - dc._screenX) ** 2 + (y - dc._screenY) ** 2);
                if (dist < dc._radius) {
                    showDetail(i);
                    return;
                }
            }
        }
        closeDetail();
    }

    function handleScroll(e) {
        e.preventDefault();
        zoom = Math.max(0.5, Math.min(3, zoom - e.deltaY * 0.001));
    }

    function handleMouseMove(e) {
        if (e.buttons === 1) {
            targetRotation += e.movementX * 0.5;
        }
    }

    function draw() {
        time++;
        rotation += (targetRotation - rotation) * 0.1;
        targetRotation *= 0.99; // Slow down

        ctx.fillStyle = 'rgba(10, 10, 15, 0.1)';
        ctx.fillRect(0, 0, width, height);

        drawFireRiskZones();
        drawWaterStress();
        drawGlobe();
        drawDatacenters();
        drawImpactRadius();

        if (time % 30 === 0) updateStats();

        requestAnimationFrame(draw);
    }

    // Initialize
    resize();
    window.addEventListener('resize', resize);
    canvas.addEventListener('click', handleClick);
    canvas.addEventListener('wheel', handleScroll, { passive: false });
    canvas.addEventListener('mousemove', handleMouseMove);

    // Auto-rotate slowly
    setInterval(() => {
        if (!document.hasFocus()) return;
        targetRotation += 0.1;
    }, 50);

    draw();
    </script>
</body>
</html>
